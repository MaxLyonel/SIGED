{% if exist == true %}
<div class="row">
    <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
        <div class="panel panel-primary shadow">
            <div class="panel-heading">
                <div class="pull-left">
                    <h3 class="panel-title">Estudiantes - Listado</h3>
                </div><!-- /.pull-left -->
                <div class="pull-right">

                </div><!-- /.pull-right -->
                <div class="clearfix"></div>
            </div><!-- /.panel-heading -->
            <div class="panel-body">
                <!-- Start project overview -->
                <ol class="breadcrumb">
                    <li>{{ nivel }}</li>
                    <li>{{ disciplina }}</li>
                    <li>{{ prueba }}</li>
                    <li>{{ genero }}</li>
                </ol>
                <!-- Start datatable -->
                {# set the array student info and convert on json string #}
                <table id="datatable" name="datatable" class="table table-striped table-default" style="padding-left: 0px; padding-right: 0px;">
                    <thead>
                        <tr>                            
                            <th data-class="expand" style="width: 30px">#</th>                         
                            <th>Entidad</th>  
                            {% if conjunto %}                       
                                <th>Equipo</th>
                            {% endif %}
                            <th>C.I.</th>
                            <th>Código Rude</th>
                            <th>Estudiante</th>
                            <th style="width: 30px">&nbsp;</th>
                        </tr>
                    </thead>
                    <tbody>
                        {#init the array info student #}
                        {% for data in objStudents %}
                            {% set objInfoStudent = [] %}
                            {% set objInfoStudent = objInfoStudent|merge(data) %}
                            {% set jsnInfoStudent = objInfoStudent|json_encode() %}
                            {% set nombre = data.paterno~' '~data.materno~' '~data.nombre %}
                            {% set rude = data.codigoRude %}           
                            {% set paralelo = data.paralelo %}         
                            {% set fase = data.fase %}         
                            {% set ue = data.ue %}         
                            {% set institucioneducativa = data.institucioneducativa %}         
                            {% set distrito = data.distrito %}          
                            {% set circunscripcion = data.circunscripcion %}    
                            {% set equipoNombre = data.equipoNombre %}       
                            {% if data.complemento == "" %}
                                {% set ci = data.carnetIdentidad %}
                            {% else %}
                                {% set ci = data.carnetIdentidad~'-'~data.complemento%}
                            {% endif %}
                            <tr>
                                <td>{{loop.index}}</td>
                                <td>
                                    {% if fase == 1 %}
                                        {{ue}} - {{institucioneducativa}}
                                    {% endif %}
                                    {% if fase == 2 %}
                                        {{distrito}}
                                    {% endif %}
                                    {% if fase == 3 %}
                                        {{ue}} - {{institucioneducativa}}
                                    {% endif %}
                                </td>
                                {% if conjunto %}                                    
                                    <td>{{equipoNombre}}</td>
                                {% endif %}
                                <td>{{ci}}</td>
                                <td>{{rude}}</td>
                                <td>{{nombre}}</td>
                                <td>
                                    <div class="ckbox ckbox-primary">
                                        <input id="id{{data.eInsJueId}}" name="estudiantes[]" type="checkbox" value="{{data.eInsJueId}}" onclick="setDeportistas(this,'{{nombre|replace({"'":"&#39;"})}}')">
                                        <label for="id{{data.eInsJueId}}"></label>
                                    </div>
                                </td>
                            </tr>
                        {%endfor%}
                    </tbody>
                    <tfoot>
                        <tr>
                            <tr>                            
                                <th data-class="expand">#</th>
                                <th>Entidad</th>  
                                {% if conjunto %}                       
                                    <th>Equipo</th>
                                {% endif %}
                                <th>C.I.</th>
                                <th>Código Rude</th>
                                <th>Estudiante</th>
                                <th>&nbsp;</th>
                            </tr>
                        </tr>
                    </tfoot>
                </table>
                <!--/ End datatable -->
                <div id="no-more-tables">  
                </div>
                <!-- /.portlet -->
                <!--/ End project overview -->  
            </div><!-- /.panel-body -->
        </div>                    
    </div>      
    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="panel panel-primary shadow">
                <div class="panel-heading">
                    <div class="pull-left">
                        <h3 class="panel-title">Clasificar</h3>
                    </div><!-- /.pull-left -->
                    <div class="pull-right">

                    </div><!-- /.pull-right -->
                    <div class="clearfix"></div>
                </div><!-- /.panel-heading -->
                <div class="panel-body">

                    {{form_start(form, { 'attr': {'data-toggle': 'validator','role': "form", 'class':'form-horizontal form-bordered'} } )}}
                        {{form_widget(form.fase)}}
                        <div class="form-group">
                            <div class="row">
                                <div class="col-md-12">
                                    {{form_label(form.posicion)}}
                                    {{form_widget(form.posicion)}}
                                </div>
                                <div class="col-md-12">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="row">
                                <div class="col-md-12">
                                    <label class="required">Deportistas: </label>
                                    <div id="listaDeportistas"></div>
                                </div>
                            </div>
                        </div>               
                    {{form_end(form)}} 
                        <div class="form-group">
                            <div class="row">
                                <div class="col-md-12">
                                    <button type="button" name="form_submit" id="form_submit" class="btn btn-success col-md-12" disabled="true" onclick="return submit()">Registrar</button>
                                </div>
                            </div>
                        </div> 
                </div><!-- /.panel-body -->
            </div>  
        </div>
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="panel panel-teal shadow">
                <div class="panel-heading">
                    <div class="pull-left">
                        <h3 class="panel-title">Deportistas Clasificados - Fase {{ fase }}</h3>
                    </div><!-- /.pull-left -->
                    <div class="pull-right">
                    </div><!-- /.pull-right -->
                    <div class="clearfix"></div>
                </div><!-- /.panel-heading -->
                <div class="panel-body">
                    <ul class="list-unstyled list-real-estate">
                        <div id="listaInscritos">
                            {% for data in objDeportistasFase%}
                                {% set nombre = data.paterno~' '~data.materno~' '~data.nombre %}
                                {% set codigo = data.eInsJueId %} 
                                {% set posicion = data.posicion %} 
                                <li id="list{{codigo}}" class="list-group-item">PUESTO {{posicion}} - {{nombre}}<div class="pull-right"><a href="#" onclick="getEliminarInscripcion('{{codigo}}');"><span class="status"><i class="fa fa-trash fa-lg fg-danger"></i></span></a></div></li>
                            {%endfor%}
                        </div> 
                    </ul>
                </div><!-- /.panel-body -->
            </div>
        </div>                          
    </div>                  
</div> 
    <!-- /.row -->
{% else %}

    <div class="row">
        <div class="col-md-12">
            {% for flashMessage in app.session.flashbag.get('warninsueall') %}
                <div class="alert alert-warning alert-dismissible" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <strong><i class='fa fa-linux'></i></strong> {{ flashMessage }}
                </div>
            {% endfor %}

        </div>
    </div>
{% endif %}

<script>
    function getEliminarInscripcion(es) {  
        elemento = document.getElementById('list' + es);   
        var r = confirm("¿ Desea eliminar el estudiante seleccionado ?");
        if (r == true) {
            $.ajax({
                type: 'get',
                url: Routing.generate('sie_juegos_eliminacion_clasificacion_deportista', {'inscripcion': es}),
                beforeSend: function () {
                    $("#list"+ es).attr('disabled', 'true');   
                },
                success: function (data) {
                    if(data.msg_incorrecto){
                        if(data.msg_incorrecto != ''){
                            $("#listaInscritos").prepend('<div class="alert alert-danger"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><strong>Error: </strong> '+data.msg_incorrecto+'</div>');
                        }
                    }

                    if(data.msg_correcto){
                        if(data.msg_correcto != ''){
                            $("#listaInscritos").prepend('<div class="alert alert-success"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><strong>Error: </strong> '+data.msg_correcto+'</div>');
                        }
                    }
                    
                    if(data.registro){
                        elemento.remove();
                    } 
                }
            });
        } 
    }

    function setDeportistas(es,des) {
        var deportistas = document.getElementsByName('deportistas[]');
        var botonAceptar = document.getElementById('form_submit');
        
        if($('[name="estudiantes[]"]').length > 0){    
            if(botonAceptar){                
                $("#form_submit").removeAttr('disabled');
            }  
        } else {   
            if(botonAceptar){
                $("#form_submit").attr('disabled', 'true');
            }    
        }

        if(es.checked){
            $("#listaDeportistas").append('<div class="ckbox ckbox-lilac circle"><input type="checkbox" checked="chequed" id="idd' + es.value + '" name="deportistas[]" value="' + es.value + '" /><label id="lbd' + es.value + '" for="idd' + es.value + '">' + des + '</label></div>');          
            botonAceptar.disabled = false;       
        }else{    
            dep = document.getElementById('idd' + es.value); 
            lbl = document.getElementById('lbd' + es.value);              
            if (dep){
                padre = dep.parentNode;
                padre.removeChild(dep);
            }
            if (lbl){
                padre2 = lbl.parentNode;
                padre2.removeChild(lbl);
            }
        }  
    }

    function habilitarBotonSubmit(){
        var selecionados = $('[name="estudiantes[]"]');
        var botonAceptar = document.getElementById('form_submit');
        var deportistas = new Array();
        //var posicion = $("#form_posicion").val();

        selecionados.each(function (){
            deportistas.push(this.value);
        });

        var cant = 0;
        for (var i=0; i < deportistas.length; i++){
            if(deportistas[i].checked == true){
                cant = 1;
            }
        }
                   
        if($('[name="estudiantes[]"]').length > 0){    
            if(botonAceptar){                
                $("#form_submit").removeAttr('disabled');
            }  
        } else {   
            if(botonAceptar){
                $("#form_submit").attr('disabled', 'true');
            }    
        }
        return true;
    }

    var chekedOff = function () {
        $('input[type=checkbox]').attr('checked',false);
    };
    
    function submit(){
        var selecionados = $('[name="deportistas[]"]');
        var fase = $("#form_fase").val();
        var posicion = $("#form_posicion").val();
        var botonAceptar = document.getElementById('form_submit');
        var deportistas = new Array();
        //var posicion = $("#form_posicion").val();

        selecionados.each(function (){
            deportistas.push(this.value);
        });        

        if($('[name="estudiantes[]"]').length > 0){
            var r = confirm("¿ Desea registrar a los "+ $('[name="deportistas[]"]').length +" estudiantes seleccionados ?");
            if (r == true) {   
                peticion = $.ajax({
                    type: 'POST',
                    url: "{{ path('sie_juegos_clasificacion_lista_deportistas_registro')}}",
                    data: {'deportistas': deportistas, 'fase': fase, 'posicion': posicion},
                    beforeSend: function () {
                        $("#listaInscritos").prepend('<div id="load" name="load" style="text-align:center"><img src="{{asset('img/loading.gif')}}" /></div>');
                        $("#form_submit").attr('disabled', 'true');
                        $("#listaDeportistas").empty();
                        chekedOff();
                    },
                    success: function (data) {
                        // for (var i in data.niveles) {
                        //    $("#form_nivel").append('<option value="' + data.niveles[i].id + '">' + data.niveles[i].nivel + '</option>');
                        // }
                        // $("#form_submit").removeAttr('disabled');

                        if(data.registrados){
                            for (var i in data.registrados) {
                                $("#listaInscritos").prepend('<li id="list' + data.registrados[i].id + '" class="list-group-item">PUESTO ' + data.registrados[i].posicion + ' - ' + data.registrados[i].nombre + '<div class="pull-right"><a href="#" onclick="getEliminarInscripcion(' + data.registrados[i].id + ');"><span class="status"><i class="fa fa-trash fa-lg fg-danger"></i></span></a></div></li>');
                            }
                        }

                        if(data.msg_incorrecto){
                            if(data.msg_incorrecto != ''){
                                $("#listaInscritos").prepend('<div class="alert alert-danger"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><strong>Error: </strong> '+data.msg_incorrecto+'</div>');
                            }
                        }
                        if(data.msg_correcto){
                            if(data.msg_correcto != ''){
                                $("#listaInscritos").prepend('<div class="alert alert-success"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><strong>Correcto: </strong> '+data.msg_correcto+'</div>');
                            }
                        }

                        $("#load").remove();

                        return true;
                    },
                    timeout: 5000, // sets timeout to 3 seconds
                    statusCode: {
                        500: function () {
                            return false;
                        },
                        404: function () {
                            return false;
                        }
                    }
                });
            } else {
                return false;
            }
        } else {
            alert("Debe seleccionar una prueba y un estudiante como mínimo");
            return false;
        }
    }
</script>

