{% extends 'layoutHerramienta.html.twig' %}

{% block contentoption %}
    <!-- Start page header -->
      {% include 'SieHerramientaBundle:Principal:breadcrumbstrail.html.twig' with {'sie': odataUedu.id, 'gestion':gestion , 'opcion': 'Estudiante'} %}
    <!--/ End page header -->

    <div class="body-content animated fadeIn">

        <!-- Start mail page -->
        <!--div class="container" style="margin-top:30px;"-->
        {% include 'SieHerramientaBundle:Principal:infoue.html.twig' with {'titulo': 'Administración Unidad Educativa', 'gestion': gestion,'sie': odataUedu.id, 'ieducativa':odataUedu.institucioneducativa, 'opcion': 'Información Estudiante'} %}
        {% include 'SieHerramientaBundle:Principal:onlyview.html.twig'%}
        {# {% include 'SieHerramientaBundle:Principal:closeRude.html.twig'%} #} 
        <div class="row">
            <div class="col-md-12 text-right">
                {#
                    {% if mostrarSextoCerrado %}
                        <button type="button" class="btn btn-success" onclick="cerrarSextoGrado({{odataUedu.id}},{{gestion}});">
                          <i class="fa fa-edit" ></i> Cerrar sexto grado
                        </button>
                    {% endif %}
                #}
                
            </div>
        </div>

        <div class="row">
            <div class="col-md-4">
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-primary" style="margin-bottom:0px">
                            <div class="panel-heading">
                                <div class="pull-left">
                                    <h5>Cursos</h5>
                                </div>
                                <div class="pull-right">
                                    Opciones:
                                    <a class="btn btn-twitter" href="{{ path('donwload_listStudentPerUe', {'gestion': gestion, 'ue': odataUedu.id} )}}" data-toggle="tooltip" data-placemente="top" data-original-title="Listado de estudiantes"><i class="fa fa-download"></i></a>
                                    <a class="btn btn-info" href="{{ path('donwload_nnats', {'gestion': gestion, 'sie': odataUedu.id} )}}" data-toggle="tooltip" data-placemente="top" data-original-title="Reporte NNATS"><i class="fa fa-download"></i></a>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <small>
                    <div class="tree well">

                        {%for turnoKey, dataTurno in aInfoUnidadEductiva%}
                            <ul>
                                <li>
                                    <span><i class="icon-folder-open"></i> {{turnoKey}}</span>
                                    <ul>
                                        {% for nivelKey,dataNivel in dataTurno %}
                                            <li>
                                                <span><i class="icon-minus-sign"></i> {{nivelKey}}</span>
                                                <ul>
                                                    {% for gradoKey, dataGrado in dataNivel %}

                                                        <li>
                                                            <span><i class="icon-minus-sign"></i> {{gradoKey}}</span>

                                                            <ul>
                                                                {% for paraleloKey, dataParalelo in dataGrado %}
                                                                    <li>
                                                                      <a href="#" onclick="seeStudents('{{dataParalelo.infoUe}}');">
                                                                        <div class="btn-group tooltips" data-toggle="tooltip" data-container="body" title="" data-original-title="Lista de Inscritos">
                                                                            <span ><i class="icon-leaf"></i>
                                                                                {{paraleloKey}}
                                                                            </span>
                                                                        </div>
                                                                      </a>                                                                      
                                                                        <!--div class="btn-group tooltips" data-toggle="tooltip" data-container="body" title="" data-original-title="Inscripción">
                                                                            <button type="button" class="btn btn-circle btn-warning btn-stroke" onclick="getStudents('{{dataParalelo.infoUe}}');" >
                                                                                <i class="fa fa-group"></i>
                                                                            </button>
                                                                        </div-->
                                                                              
                                                                        <div class="btn-group tooltips" data-toggle="tooltip" data-container="body" title="" data-original-title="Areas/Maestros">
                                                                            <button class="btn btn-circle btn-danger btn-stroke " data-toggle="modal" data-target=".bs-example-modal-table" onclick="getAreas('{{dataParalelo.infoUe}}');">
                                                                                <i class="fa fa-group"></i>
                                                                            </button>
                                                                        </div>
                                                                        
                                                                        <!--button type="button" class="btn btn-warning btn-xs dropdown-toggle" data-toggle="dropdown" tabindex="-1">
                                                                            <i class="fa fa-caret-square-o-down"></i>
                                                                        </button>
                                                                        <table class="dropdown-menu pull-left" role="menu">
                                                                            <tr>
                                                                                <td>
                                                                                    <button type="button" class="btn btn-link" onclick="getStudents('{{dataParalelo.infoUe}}');">
                                                                                        <i class ="fa fa-pencil"></i> Inscripción
                                                                                    </button>
                                                                                </td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td>
                                                                                    <button type="button" class="btn btn-link" onclick="seeStudents('{{dataParalelo.infoUe}}');">
                                                                                        <i class="fa fa-group"></i> Inscripción
                                                                                    </button>
                                                                                </td>
                                                                            </tr>

                                                                        </table-->

                                                                        <div class="btn-group tooltips" data-toggle="tooltip" data-container="body" title="" data-original-title="Datos del curso">
                                                                            <button class="btn btn-circle btn-info btn-stroke " data-toggle="modal" data-target=".bs-example-modal-table" onclick="getDatosCurso('{{dataParalelo.infoUe}}');">
                                                                                <i class="fa fa-list"></i>
                                                                            </button>
                                                                        </div>
                                                                        {% if dataParalelo.nivelId == 13 and dataParalelo.gradoId == 6 %}
                                                                            
                                                                                <div class="btn-group tooltips" data-toggle="tooltip" data-container="body" title="" data-original-title="Registro de Especialidades">
                                                                                    <button class="btn btn-circle btn-success btn-stroke " onclick="optionsBth('{{dataParalelo.infoUe}}');">
                                                                                    <i class="fa fa-group"></i>
                                                                                    </button
                                                                                </div>
                                                                        {% endif %}

                                                                    </li>
                                                                {% endfor %}
                                                            </ul>

                                                        </li>
                                                    {% endfor %}
                                                </ul>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </li>
                            </ul>
                        {% endfor %}

                    </div>
                </small>
            </div>

            <div class='col-md-8'>
                <div id="idstudents"></div>
            </div>

        </div>

        <!--/div-->
        <!--/ End mail page -->
    </div>
    <!-- Start body content -->
    <!--/ End body content -->
    <div class="modal fade bs-example-modal-table" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" id="modal">

    </div><!-- /.modal -->
    <!--/ End body content -->
{% endblock %}
{% block javascripts%}
    {{parent()}}
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.15.2/axios.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
    <script>
        /**
         * this is to the tree menu option
         * @returns {undefined}
         */
        $(function () {
            $('.tree li:has(ul)').addClass('parent_li').find(' > span').attr('title', 'Expandir esta rama');
            $('.tree li.parent_li > span').on('click', function (e) {
                var children = $(this).parent('li.parent_li').find(' > ul > li');
                if (children.is(":visible")) {
                    children.hide('fast');
                    $(this).attr('title', 'Expandir esta rama').find(' > i').addClass('icon-plus-sign').removeClass('icon-minus-sign');
                } else {
                    children.show('fast');
                    $(this).attr('title', 'Contraer esta rama').find(' > i').addClass('icon-minus-sign').removeClass('icon-plus-sign');
                }
                e.stopPropagation();
            });
        });

        var cerrarRude = function(sie, gestion){
          $.ajax({
              type: 'get',
              data: ({sie: sie, gestion: gestion}),
              url: Routing.generate('herramienta_info_estudiante_cerrarRude'),
              beforeSend: function () {
                  $("#idCerrarRude").empty();
                  $("#idCerrarRude").append('<div style="text-align:center"><img src="{{asset('img/loading.gif')}}" /></div>');
              },
              success: function (data) {
                  $("#idCerrarRude").empty();
                  $("#idCerrarRude").append(data);
              },
              statusCode: {
                  500: function () {

                  },
                  404: function () {

                  }
              }
          });

        };

        var getStudents = function (infoUe) {

            $.ajax({
                type: 'get',
                /*data: ({iecId: iecId, nivel: nivel, sie: sie, gestion: gestion, grado: grado, paralelo: paralelo, turno: turno, ciclo: ciclo}),*/
                /*url: Routing.generate('inscription_ue_all_sie_get_students'),*/
                data: ({infoUe: infoUe}),
                url: Routing.generate('herramienta_info_estudiante_get_students'),
                beforeSend: function () {
                    $("#idstudents").empty();
                    $("#idstudents").append('<div style="text-align:center"><img src="{{asset('img/loading.gif')}}" /></div>');
                },
                success: function (data) {
                    $("#idstudents").empty();
                    $("#idstudents").append(data);
                },
                statusCode: {
                    500: function () {

                    },
                    404: function () {

                    }
                }
            });
        };

        
        var optionsBth = function (infoUe) {

            $.ajax({
                type: 'get',
                data: ({infoUe: infoUe}),
                url: Routing.generate('herramienta_info_estudiante_optionsBth'),
                beforeSend: function () {
                    $("#idstudents").empty();
                    $("#idstudents").append('<div style="text-align:center"><img src="{{asset('img/loading.gif')}}"  /></div>');
                },
                success: function (data) {
                    $("#idstudents").empty();
                    $("#idstudents").append(data);
                    $('.tooltips').tooltip();
                },
                statusCode: {
                    500: function () {

                    },
                    404: function () {

                    }
                }
            });
        };

        var seeStudents = function (infoUe) {

            $.ajax({
                type: 'get',
                data: ({infoUe: infoUe}),
                url: Routing.generate('herramienta_info_estudiante_see_students'),
                beforeSend: function () {
                    $("#idstudents").empty();
                    $("#idstudents").append('<div style="text-align:center"><img src="{{asset('img/loading.gif')}}"  /></div>');
                },
                success: function (data) {
                    $("#idstudents").empty();
                    $("#idstudents").append(data);
                    $('.tooltips').tooltip();
                },
                statusCode: {
                    500: function () {

                    },
                    404: function () {

                    }
                }
            });
        };

        var doInscription = function () {
            var elem = document.getElementById('formStudentInscription').elements;
            var sw = true;
            for (var i = 0; i < elem.length; i++) {
                if (elem[i].type == 'checkbox')
                    if ((elem[i].checked))
                        sw = false;
            }
            if (sw) {
                alert('Tiene que Seleccionar por lo menos una Inscripción...');
                return flase;
            }
            var formIns = $('#formStudentInscription').serialize();
            $.ajax({
                type: 'post',
                data: formIns,
                url: Routing.generate('herramienta_info_estudiante_inscription'),
                beforeSend: function () {
                    $("#idstudents").empty();
                    $("#idstudents").append('<div style="text-align:center"><img src="{{asset('img/loading.gif')}}" /></div>');
                },
                success: function (data) {
                    $("#idstudents").empty();
                    $("#idstudents").append(data);
                },
                statusCode: {
                    500: function () {

                    },
                    404: function () {

                    }
                }
            });

        };
        var selectAllEle = function () {
            $("#checkAll").on("change", function () {
                $(this).closest("div").find("input:checkbox").prop("checked", $(this).prop("checked"));
            });

        };
        var getTurnos = function (nivel, sie, gestion, nivelname, key) {
            $.ajax({
                type: 'post',
                data: ({nivel: nivel, sie: sie, gestion: gestion, nivelname: nivelname}),
                /*url: Routing.generate('inscription_ue_all_sie_get_turnos'),*/
                url: "{{ path('herramienta_info_estudiante_get_turnos') }}",
                beforeSend: function () {
                    /* $("#idgrados").empty();
                     $("#idparalelos").empty();
                     $("#idstudents").empty();*/
                    $("#idgrados_" + key).append('<div style="text-align:center"><img src="{{asset('img/loading.gif')}}"  /></div>');
                },
                success: function (data) {
                    $("#idgrados_" + key).empty();
                    $("#idgrados_" + key).append(data);
                },
                statusCode: {
                    500: function () {

                    },
                    404: function () {

                    }
                }
            });
        };

        var getParalelos = function (nivel, sie, gestion, turno, turnoname, nivelname, key) {

            $.ajax({
                type: 'post',
                data: ({nivel: nivel, sie: sie, gestion: gestion, turno: turno, turnoname: turnoname, nivelname: nivelname}),
                /*url: Routing.generate('inscription_ue_all_sie_get_paralelos'),*/
                url: "{{ path('inscription_ue_all_sie_get_paralelos') }}",
                beforeSend: function () {
                    /* $("#idparalelos").empty();
                     $("#idstudents").empty();*/
                    $("#idparalelos_" + key).append('<div style="text-align:center"><img src="{{asset('img/loading.gif')}}"  /></div>');
                },
                success: function (data) {
                    /*$("#idstudents").empty();
                     $("#idparalelos").empty();*/
                    $("#idparalelos_" + key).append(data);
                },
                statusCode: {
                    500: function () {

                    },
                    404: function () {

                    }
                }
            });
        };

        var getDatosCurso = function (infoUe) {
            $.ajax({
                type: 'post',
                data: ({infoUe: infoUe}),
                url: "{{ path('herramienta_infoEstudianteDatosCurso_index') }}",
                beforeSend: function () {
                    $('#modal').empty();
                },
                success: function (data) {
                    $('#modal').empty();
                    $('#modal').append(data);
                },
                statusCode: {
                    500: function () {

                    },
                    404: function () {

                    }
                }
            });
        };

        var getAreas = function (infoUe) {
            $.ajax({
                type: 'post',
                data: ({infoUe: infoUe}),
                url: "{{ path('herramienta_infoEstudianteAreas_index') }}",
                beforeSend: function () {
                    $('#modal').empty();
                },
                success: function (data) {
                    $('#modal').empty();
                    $('#modal').append(data);
                },
                statusCode: {
                    500: function () {

                    },
                    404: function () {

                    }
                }
            });
        };
        var inscriptionWithRude = function (aData) {

            $.ajax({
                type: 'post',
                data: ({aData: aData}),
                url: Routing.generate('herramienta_info_estudiante_with_rude'),
                beforeSend: function () {
                    $("#idstudents").empty();
                    $("#idstudents").append('<div style="text-align:center"><img src="{{asset('img/loading.gif')}}"  /></div>');
                },
                success: function (data) {
                    $("#idstudents").empty();
                    $("#idstudents").append(data);
                },
                statusCode: {
                    500: function () {

                    },
                    404: function () {

                    }
                }
            });

        };
        var doRudeInscription = function () {
            //get data send
            rude = $('#form_rude').val();
            dataInscription = $('#form_dataInscription').val();
            if (rude.length <= 0) {
                alert('Necesita introducir codigo Rude');
                return false;
            }

            $.ajax({
                type: 'post',
                data: ({rude: rude, dataInscription: dataInscription}),
                url: Routing.generate('herramienta_info_estudiante_rude_inscription'),
                beforeSend: function () {
                    $("#resultfindrude").empty();
                    $("#resultfindrude").append('<div style="text-align:center"><img src="{{asset('img/loading.gif')}}" /></div>');
                },
                success: function (data) {
                    $("#resultfindrude").empty();
                    $("#resultfindrude").append(data);
                },
                statusCode: {
                    500: function () {

                    },
                    404: function () {

                    }
                }
            });

        };

        var exeInscription = function () {
            //get data send
            dataInscription = $('#form_dataInscription').val();
            dataStudent = $('#form_dataStudent').val();

            $.ajax({
                type: 'post',
                data: ({dataStudent: dataStudent, dataInscription: dataInscription}),
                url: Routing.generate('herramienta_info_estudiante_exe_inscription'),
                beforeSend: function () {
                    $("#resultfindrude").empty();
                    $("#resultfindrude").append('<div style="text-align:center"><img src="{{asset('img/loading.gif')}}"  /></div>');
                },
                success: function (data) {
                    $("#resultfindrude").empty();
                    $("#resultfindrude").append(data);
                },
                statusCode: {
                    500: function () {

                    },
                    404: function () {

                    }
                }
            });

        };


  /* the new to do the inscriptions*/
   var doInscriptionsWithOutRude = function(data){
     $.ajax({
         type: 'post',
         data: ({infoUe: data }),
         url: "{{ path('inscriptionstudent_without_rude_index') }}",
         beforeSend: function () {
             $('#modal').empty();
         },
         success: function (data) {
             $('#modal').empty();
             $('#modal').append(data);
         },
         statusCode: {
             500: function () {

             },
             404: function () {

             }
         }
     });
   };


       var doInscriptionsRude = function(data){
        $.ajax({
            type: 'post',
            data: ({infoUe: data }),
            url: "{{ path('inscriptionstudent_index') }}",
            beforeSend: function () {
                $('#modal').empty();
            },
            success: function (data) {
                $('#modal').empty();
                $('#modal').append(data);
            },
            statusCode: {
                500: function () {

                },
                404: function () {

                }
            }
        });
      };

      function cerrarSextoGrado(sie, gestion){
          $.ajax({
            url: Routing.generate('herramienta_info_estudiante_cerrarSextoGrado'),
            // type: 'POST',
            data: {sie: sie, gestion: gestion},
            beforeSend: function(){

            },
            success: function(data){

                location.reload();
            },
            error: function(){

            }
          });
      }


    </script>
{%endblock%}
