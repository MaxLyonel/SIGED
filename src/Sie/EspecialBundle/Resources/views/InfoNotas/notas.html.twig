{% set onlyview = app.session.get('onlyview') %}
{% if notas is defined %}
	<div class="modal-dialog modal-lg" {% if (notas.gestion > 2018 and discapacidad in [2,3,5]) %} style="width:80%; z-index:99999;" {% endif %}>
	    <div class="modal-content" {% if ((notas.gestion < 2019 and discapacidad in [2,3,5]) or discapacidad not in [2,3,5]) %} style="width:900px; margin-left:-100px" {% endif %}>
	    	<form action="" id="formNotasEspecial" onsubmit="registrarNotasEspecial(); return false">

	 		<input type="hidden" name="actualizar" value="{{actualizar}}">
	 		<input type="hidden" name="operativo" value="{{operativo}}">
	 		<input type="hidden" name="discapacidad" value="{{discapacidad}}">

	        <div class="panel panel-danger">
	            <div class="modal-header" style="background:#D52F27">
	                <div class="pull-left">
	                    <h3 class="panel-title" style="color:#FFFFFF">{% if (notas.gestion > 2018 and discapacidad in [7]) %} Seguimiento {% else %} Notas {% endif %} del Estudiante</h3>
	                </div>
	                <div class="clearfix"></div>
	            </div>
	            <div class="panel-body no-padding" id="modal-body">
	            	<div class="alert " style="padding:10px">
					    <h5 class="text-lilac">Datos del Curso/Grupo</h5>
					    <table class="table table-condensed table-bordered" style="background:#EEEEEE">
					        <tr>
					            <th>Nivel</th><td>{{inscripcion.institucioneducativaCurso.nivelTipo.nivel|upper}}</td>
					            <th>Turno</th><td>{{inscripcion.institucioneducativaCurso.turnoTipo.turno|upper}}</td>
					        </tr>
					        <tr>
					            <th>Grado</th><td>{{inscripcion.institucioneducativaCurso.gradoTipo.grado|upper}}</td>
					            <th>Paralelo</th><td>{{inscripcion.institucioneducativaCurso.paraleloTipo.paralelo|upper}}</td>
					        </tr>
					    </table>

					    <h5 class="text-info">Datos del Estudiante</h5>
					    <table class="table table-condensed table-bordered" style="background:#EEEEEE">
					        <tr>
					            <th>Código Rude</th><td style="color:#0086DD">{{inscripcion.estudiante.codigoRude}}</td>
					        </tr>
					        <tr>
					            <th>Estudiante</th><td style="color:#0086DD"><b>{{inscripcion.estudiante.nombre}} {{inscripcion.estudiante.paterno}} {{inscripcion.estudiante.materno}}</b></td>
					        </tr>
					        <tr>
					            <th>Estado de matrícula</th><td>{{inscripcion.estadomatriculaTipo.estadomatricula}}</td>
					        </tr>
					    </table>
						{% if (notas.gestion > 2018 and discapacidad in [7]) %}
						<h5 style="color:#0086DD">Seguimiento</h5>
						{% else %}
						<h5>Notas <small style="float:right;color:#4D8595">Operativo Actual-{{notas.operativo}}</small></h5>
						{% endif %}
					    {# {% include 'SieAppWebBundle:Services/Notas:'~ template ~'.html.twig' with {'notas':notas, 'vista':vista} %} #}
						{% include 'SieAppWebBundle:Services/Notas:'~ template ~'.html.twig' with { 'notas':notas, 'vista':vista, 'discapacidad':discapacidad } %}

						{% if (operativo >= 4 and notas.estadoMatricula in notas.estadosPermitidos and notas.cuantitativas|length > 0 and actualizar == false) or (notas.gestion < notas.gestionActual and notas.tipoNota == 'Trimestral' and discapacidad != 1) or (notas.gestion < notas.gestionActual and discapacidad == 1 and notas.nivel in [1,11,403]) and notas.cuantitativas|length > 0 %}
							<table class="table table-condensed table-bordered" style="background:#8AE5B6">
								<tr>
									<th style="vertical-align:middle; text-align:center">Actualizar estado de matrícula</th>
									<td>
										<select name="nuevoEstadomatricula" id="" class="form-control" required="required">
											<option value="">Seleccionar...</option>
											{% for em in estadosMatricula %}
												{% if notas.estadoMatricula == em.id %}
													{% set selected = 'selected' %}
												{% else %}
													{% set selected = '' %}
												{% endif %}
												<option value="{{em.id}}" {{selected}} >{{em.estadomatricula}}</option>
											{% endfor %}
										</select>
									</td>
								</tr>
							</table>
						{% endif %}
					</div>

	            </div>
	        </div>
	        <div class="modal-footer">
	            <button type="button" class="btn btn-danger" data-dismiss="modal">Cerrar</button>
	            {% if notas.estadoMatricula in notas.estadosPermitidos and notas.cuantitativas|length > 0 and onlyview == false %}
		            <button type="submit" class="btn btn-success">Guardar Cambios</button>
		        {% endif %}
				{% if (notas.estadoMatricula in notas.estadosPermitidos and notas.gestion > 2018 and discapacidad in [7]) %}
					<button type="submit" class="btn btn-success">Guardar</button>
				{% endif %}
	        </div>
	    </div><!-- /.modal-content -->
	    </form>
	</div><!-- /.modal-dialog -->
{% else %}
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="alert alert-warning"><i class="fa fa-warning"></i> Opción no disponible.</div>
		</div>
	</div>
{% endif %}
<script>

    var registrarNotasEspecial = function(){
    	var enviar = validarEnvioNotas();
        if(enviar == true){
	    	var formData = $('#formNotasEspecial').serialize();//"textarea[name!=int1]", .not('form[textarea]')
			//Seguimiento para Talento Extraordinario
			var notas = [];
			$("#tbl_nota tbody tr").each(function() {
				$this = $(this);
				notas.push({"inter": $this.find("textarea.pi").val(), "desc": $this.find("textarea.dc").val()});
			});
			formData = formData+"&seguimiento="+JSON.stringify(notas);
		    $.ajax({
		        type: 'post',
		        url: Routing.generate('especialInfoNotas_create_update'),
		        data: formData,
		        beforeSend: function () {
		            $('#modal-body').empty();
		            $('.modal-footer').empty();
		            $('#modal-body').append("<div style='text-align:center; padding:10px; color:#6ECBFF; font-size:15px'><img src='{{asset('img/loading-sm.gif')}}'><br>Espere mientras se procesan los cambios...</div>");
		        },
		        success: function (data) {
		            $('#modal').modal('hide');
		        },
		        error: function (data) {

		        }
		    });
		}
	}
</script>
