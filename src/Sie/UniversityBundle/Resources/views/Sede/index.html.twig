{% extends 'layoutUniversity.html.twig' %}
{% block contentBread %}
<i class="fa fa-angle-right"></i>
<a href="#">Sedes</a>
{% endblock %}
{% block contentoption %}
    {% if sedes is defined  %}
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12">
                <div class="panel">                        
                    <div class="panel-head">
                        <table id="tabla" class="table table-striped table-bordered table-default" cellspacing="0">
                            <thead>
                                <tr>
                                    <th style="width:50px; text-align:center;">#</th>
                                    <th style="text-align:center;">SEDE</th>
                                    <th style="width:50px; text-align:center;">
                                        &nbsp;
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {% set c = 0 %}
                                {% for sede in sedes %}
                                    {% set c = c + 1 %}
                                    {% set id = sede.id|base64_encode %}
                                    {% set nombre = sede.sede %}
                                    {% set sucursal = sede.sucursal %}
                                    <tr>
                                        <td style="text-align:center;">
                                            {{c}}
                                        </td>
                                        <td>{{ nombre }}</td>
                                        <td>
                                            {% if sucursal == 0 %}
                                                <a href="javascript:void(0);" onclick="ingresoSede('{{id}}',this)" class="btn btn-warning" data-toggle="modal" data-target="#modal">Actualizar</a>
                                            {% else  %}
                                                <a href="javascript:void(0);" onclick="ingresoSede('{{id}}',this)" class="btn btn-success" data-toggle="modal" data-target="#modal">Actualizar</a>
                                                
                                            {% endif  %}
                                        </td>    
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div><!-- /.panel-body -->
                </div>
            </div>
        </div><!-- /.row -->
    {% endif %}

{% endblock %}

{% block javascripts%}
{{parent()}}
<script>

    var ingresoSede = function (sede, bot){
        botonForm = $(bot); 
        $.ajax({
            type: 'post',
            url: Routing.generate('sie_university_sede_update', {'sede': sede}),
            beforeSend: function () {
                $("#modalBody").empty();
                $("#modalBody").append('<div class="text-center"><img src="{{asset('img/loading.gif')}}" class="loading img-responsive" /></div>');
            },
            success: function (data) {      
                $("#modalBody").empty();  
                $("#modalBody").html(data);                  
            },
            error: function(error){          
                $("#modalBody").empty();           
                $("#modalBody").append('<div class="text-center">Error</div>');   
            },
        });     
    };

 

    var ingresoSedePrueba = function (sede){
        alert(sede);
        var botonGuardar = $('#form_guardar');
        var formulario = $('#form')[0];
        var formData = new FormData(formulario);
        $.ajax({
            type: 'post',
            url: Routing.generate('sie_university_sede'),
            data: formData,
            processData: false,
            contentType: false,
            beforeSend: function () {
                $('#formulario').append('<div style="text-align:center" id="load"><img src="{{asset('img/loading.gif')}}" /></div>');
                botonGuardar.hide();
            },
            success: function (data) {
                if(data.estado){         
                    $('#modal').modal('hide');
                    table.row.add([(table.rows().count()+1), data.info.departamento, data.info.tipo, data.info.persona, `<div id="img`+(table.rows().count()+1)+`" ><img style="display: block; width: 150px; height:150px;" src="data:image/png;base64,`+data.info.firma+`" /></div>`, data.info.fecha, `<div class="ckbox ckbox-primary"><input id="estado`+(table.rows().count()+1)+`" checked="checked" type="checkbox" onchange="modificaEstado(this, '`+data.info.id+`');"><label for="estado`+(table.rows().count()+1)+`"></label></div>`, `<button type='button' class='btn btn-inverse btn-stroke' data-toggle='modal' data-target='.bs-example-modal-form' onclick="modifica('`+data.info.id+`', '`+(table.rows().count()+1)+`');"><i class="fa fa-edit"></i> Cambiar Firma</button><button type="button" class="btn btn-danger" onclick="eliminar('`+data.info.id+`', '`+(table.rows().count()+1)+`',this);" ><i class="fa fa-trash"></i> Eliminar</button>`]);
                    table.draw();
                    alert("Correcto, "+data.msg);
                } else {    
                    $('#load').remove();
                    $("#formulario").prepend('<div class="alert alert-danger alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">Ã—</button><strong>Error:</strong> '+data.msg+'</div>');                 
                    botonGuardar.show();
                }                    
            }, 
            error: function(error){
                $('#load').remove();
                alert("Error, no fue posible enviar el formulario, intente nuevamente");  
                botonGuardar.show();
            },
        }); 
        return true;
    };
</script>
{% endblock %}