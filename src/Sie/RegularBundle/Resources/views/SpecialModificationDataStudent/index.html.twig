
{% extends 'layoutRegular.html.twig' %}
{% block stylesheets %}
    {{parent()}}
    <style>
        .higherWider {
            width:800px;
            margin-top:100px;
        }
        [v-cloak]{
            display: none;
        }
        .tachado{
            text-decoration: line-through;
            /* color: #D5956E; */
            color:  #D51528;
            opacity: 0.4;
        }        
    </style>

{% endblock %}
{% block contentoption %}


    <div class="row">
        <div class="col-lg-12">
            <div class="page-title">
                <h1><i class="fa fa-cc-amex animated flip"></i>Modificación de Datos
                    <small></small>
                </h1>
                <ol class="breadcrumb">
                    <li><i class="fa fa-dashboard"></i>  <a href="#">Buscar </a>
                    </li>


                </ol>
            </div>
        </div>
        <!-- /.col-lg-12 -->
    </div>

    <div class="row">
        <div class="col-md-12">
            {% for flashMessage in app.session.flashbag.get('warningremoveins') %}
                <div class="alert alert-danger alert-dismissible" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <strong><i class='fa fa-linux'></i></strong> {{ flashMessage }}
                </div>
            {% endfor %}
        </div>

    </div>

    <!-- /.row -->
    <div id="app">
    <div v-cloak>

        <div class="row">
            <div class="col-xs-12 col-lg-12">
                <div class="panel panel-icon panel-default">
                    <div class="panel-heading">
                        <i class="fa fa-search"></i>
                        <div class="pull-right">
                            {# <a href="{{ path('estudiantehistorialmodificacion') }}">Retornar Lista</a> #}
                        </div>                                        
                    </div>
                    <div class="panel-body">
                        <!-- form to search student -->
                        <div class="form-group row buscador">
                            
                            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                                <input type="text" class="form-control" v-model="rudeBuscar" maxlength="18" v-on:keyup.enter="" placeholder="Código rude">
                            </div>

                            <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 text-right">
                                <select id="form_arrOption" name="form[arrOption]" required="required" class="form-control col-lg-6 col-md-6 col-sm-6" v-model="optionBuscar">
                                    <option value="0">Concluyó el Bachillerato</option>
                                    <option value="1">Tiene registro en gestiones pasadas</option>
                                </select>
                            </div>


                            <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
                                <button v-on:click="buscarEstudiante()" type="button" class="btn btn-primary"><i class="fa fa-search"></i> </button>
                            </div>
                        </div>
                        <!-- end form to search student -->
                                                      

                            <div class="alert alert-warning" v-if="respuesta != ''"> <i class="fa fa-warning"></i> ${respuesta}</div>
                            <div v-if="buscando" class="text-center">
                                <img src="{{asset('img/loading.gif')}}" alt=""> Buscando...
                            </div>
                            <!-- && !buscando -->
                            <div v-if="studentId != ''  ">
                                <!-- <div v-if="buscando"> -->
                                </br></br>
                                    <p class="encabezado bg-primary">MODIFICACION Y/O INCLUSIÓN DE NOMBRE(S), APELLIDO(S) Y/O MODIFICACION DE FECHA DE NACIMIENTO
                                        <a class="btn btn-default" data-toggle="modal" href='#modalEstudianteOne'> <i class="fa fa-pencil"></i> </a>
                                    </p>
                                    <table class="table table-primary" border="0" >
                                        <tr>
                                            <!-- <th>Código Rude</th>
                                            <td>${codigoRude}</td> -->
                                            <th>Carnet</th>
                                            <td>
                                                <span v-bind:class="{tachado: dataStudent.carnetIdentidad != dataStudentModif.carnetIdentidad }"> ${dataStudent.carnetIdentidad}</span>
                                                </br>
                                                <p v-if="dataStudent.carnetIdentidad != dataStudentModif.carnetIdentidad " class="text-green">
                                                    <strong>${dataStudentModif.carnetIdentidad}</strong>
                                                </p>
                                            </td>
                                            <th>Complemento</th>
                                            <td>
                                                <span v-bind:class="{tachado: dataStudent.complemento != dataStudentModif.complemento  }"> ${dataStudent.complemento}</span>
                                                </br>
                                                <p v-if="dataStudent.complemento != dataStudentModif.complemento " class="text-green">
                                                    <strong>${dataStudentModif.complemento}</strong>
                                                </p>
                                            </td>
                                            <th>Fecha Nacimiento</th>
                                            <td>
                                                <span v-bind:class="{tachado: dataStudent.fechaNacimiento != dataStudentModif.fechaNacimiento}"> ${dataStudent.fechaNacimiento}</span>
                                                </br>
                                                <p v-if="dataStudent.fechaNacimiento != dataStudentModif.fechaNacimiento " class="text-green">
                                                    <strong>${dataStudentModif.fechaNacimiento}</strong>
                                                </p>
                                            </td>
                                            <td rowspan="2" align="right">
                                                
                                            </td>
                                            
                                        </tr>
                                        <tr>
                                            <th>Paterno</th>
                                            <td>
                                                <span v-bind:class="{tachado: dataStudent.paterno != dataStudentModif.paterno }"> ${dataStudent.paterno}</span>
                                                  </br>
                                                <p v-if="dataStudent.paterno != dataStudentModif.paterno " class="text-green">
                                                    <strong>${dataStudentModif.paterno}</strong>
                                                </p>
                                            </td>
                                            <th>Materno</th>
                                            <td>
                                                <span v-bind:class="{tachado: dataStudent.materno != dataStudentModif.materno }"> ${dataStudent.materno}</span>
                                                  </br>
                                                <p v-if="dataStudent.materno != dataStudentModif.materno " class="text-green">
                                                    <strong>${dataStudentModif.materno}</strong>
                                                </p>
                                            </td>
                                            <th>Nombre(s)</th>
                                            <td>
                                                <span v-bind:class="{tachado: dataStudent.nombre != dataStudentModif.nombre }"> ${dataStudent.nombre}</span>
                                                  </br>
                                                <p v-if="dataStudent.nombre != dataStudentModif.nombre " class="text-green">
                                                    <strong>${dataStudentModif.nombre}</strong>
                                                </p>
                                            </td>
                                        </tr>
                                    </table>
                                    <br>
                                    <p class="encabezado bg-primary">MODIFICACIÓN Y/O INCLUSIÓN DE DATOS PROPIOS DEL CERTIFICADO DE NACIMIENTO
                                        <a class="btn btn-default" data-toggle="modal" href='#modalEstudianteTwo'> <i class="fa fa-pencil"></i> </a>
                                    </p>
                                    <table class="table table-primary" border="0">
                                        <tr>
                                            <th colspan="2">Género</th>
                                            <td colspan="3">
                                                <span v-bind:class="{tachado: dataStudent.generoTipo != dataStudentModif.generoTipo}"> ${dataStudent.generoTipo}</span>
                                                </br>
                                                <p v-if="dataStudent.generoTipo != dataStudentModif.generoTipo " class="text-green">
                                                    <strong>${dataStudentModif.generoTipo}</strong>
                                                </p>
                                            </td>
                                            <th colspan="2">Pasaporte</th>
                                            <td colspan="3">
                                                <span v-bind:class="{tachado: dataStudent.pasaporte != dataStudentModif.pasaporte}"> ${dataStudent.pasaporte}</span>
                                                </br>
                                                <p v-if="dataStudent.pasaporte != dataStudentModif.pasaporte " class="text-green">
                                                    <strong>${dataStudentModif.pasaporte}</strong>
                                                </p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Pais</th>
                                            <td>
                                               <span v-bind:class="{tachado: dataStudent.pais != dataStudentModif.pais }"> ${dataStudent.pais}</span> 
                                                </br>
                                                <p v-if="dataStudent.pais != dataStudentModif.pais " class="text-green">
                                                    <strong>${dataStudentModif.pais}</strong>
                                                </p>
                                            </td>
                                            <th>Departamento</th>
                                            <td>
                                                <span v-bind:class="{tachado: dataStudent.lugarNacTipo != dataStudentModif.lugarNacTipo  }"> ${dataStudent.lugarNacTipo}</span> 
                                                </br>
                                                <p v-if="dataStudent.lugarNacTipo != dataStudentModif.lugarNacTipo " class="text-green">
                                                    <strong>${dataStudentModif.lugarNacTipo}</strong>
                                                </p>
                                            </td>
                                            <th>Provincia</th>
                                            <td>
                                                <span v-bind:class="{tachado: dataStudent.lugarProvNacTipo != dataStudentModif.lugarProvNacTipo  }"> ${dataStudent.lugarProvNacTipo}</span>
                                                </br>
                                                <p v-if="dataStudent.lugarProvNacTipo != dataStudentModif.lugarProvNacTipo " class="text-green">
                                                    <strong>${dataStudentModif.lugarProvNacTipo}</strong>
                                                </p>

                                            </td>
                                            <th>Localidad</th>
                                            <td>
                                                <span v-bind:class="{tachado: dataStudent.localidad != dataStudentModif.localidad   }"> ${dataStudent.localidad}</span>
                                                </br>
                                                <p v-if="dataStudent.localidad != dataStudentModif.localidad " class="text-green">
                                                    <strong>${dataStudentModif.localidad}</strong>
                                                </p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Oficialia</th>
                                            <td>
                                                <span v-bind:class="{tachado: dataStudent.oficialia != dataStudentModif.oficialia    }"> ${dataStudent.oficialia}</span>
                                                 </br>
                                                <p v-if="dataStudent.oficialia != dataStudentModif.oficialia " class="text-green">
                                                    <strong>${dataStudentModif.oficialia}</strong>
                                                </p>
                                            </td>
                                            <th>Libro</th>
                                            <td>
                                                <span v-bind:class="{tachado: dataStudent.libro != dataStudentModif.libro }"> ${dataStudent.libro}</span>
                                                 </br>
                                                <p v-if="dataStudent.libro != dataStudentModif.libro " class="text-green">
                                                    <strong>${dataStudentModif.libro}</strong>
                                                </p>
                                            </td>
                                            <th>Partida</th>
                                            <td>
                                                <span v-bind:class="{tachado: dataStudent.partida != dataStudentModif.partida }"> ${dataStudent.partida}</span>
                                                 </br>
                                                <p v-if="dataStudent.partida != dataStudentModif.partida " class="text-green">
                                                    <strong>${dataStudentModif.partida}</strong>
                                                </p>
                                            </td>
                                            <th>Folio</th>
                                            <td>
                                                <span v-bind:class="{tachado: dataStudent.folio != dataStudentModif.folio }"> ${dataStudent.folio}</span>
                                                 </br>
                                                <p v-if="dataStudent.folio != dataStudentModif.folio " class="text-green">
                                                    <strong>${dataStudentModif.folio}</strong>
                                                </p>
                                            </td>
                                        </tr>
                                    </table>
                                    <br>

                                    
                                    <table class="table table-primary" v-if="swCertification">
                                        <tr>
                                            <td>
                                            <p class="encabezado bg-primary">DATOS REQUERIDOS PARA LA MODIFICACIÓN</p>
                                            </td>
                                        </tr>                                    
                                        <tr>
                                            <th>Resolucion Administrativa</th>
                                            <td>
                                                <input type="text" id="form_resoladm" name="form[resoladm]" class="form-control" pattern="[A-Za-z0-9-/ ]{0,15}" v-model="dataStudentModif.resolucionAdm">
                                            </td>
                                            <th>Fecha Resolucion</th>
                                            <td>
                                                <input type="text" id="form_fecharesoladm" name="form[fecharesoladm]" class="form-control" pattern="[A-Za-z0-9-/ ]{0,15}" v-model="dataStudentModif.fecharesolAdm">
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Justificativo</th>
                                            <td colspan="4">
                                                <textarea id="form_obs" name="form[obs]" class="form-control" pattern="[A-Za-z0-9-/ ]{0,25}" v-model="dataStudentModif.justificativo"></textarea>
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Adjuntar Resolucion</th>
                                            <td colspan="4">
                                                {# <input type="file" > #}
                                                <input type="file" name="image" @change="getImage" accept="file/*" class="form-control" id="archivoAdjuntoId">
                                            </td>
                                        </tr>

                                    </table>
                                  
                                     <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3" v-if="swOne || swTwo">
                                       <table>
                                        <tr v-if="showbuttonPDF">
                                          <tH><a href="#"> <i class="fa fa-download"> DESCARGAR MODIFICACIÓN</i> </a></tH>
                                        </tr>
                                        <tr v-else>
                                         <td><button v-on:click="updateStudent()" type="button" class="btn btn-primary"><i class="fa fa-save"> Guardar Cambios</i> </button></td>
                                         <td><button v-on:click="cancelupdateStudent()" type="button" class="btn btn-danger"><i class="fa fa-remove"> Cancelar Cambios</i> </button></td>
                                        </tr>
                                       </table> 
                                     </div>
                                     <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3" v-else>                                        
                                     </div>



                                            <div class="modal fade in" id="modalEstudianteOne"  tabindex="-1" role="dialog" data-backdrop="static" >
                                                <div class="modal-dialog" style="width:800px" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                                            <h4 class="modal-title">MODIFICACION Y/O INCLUSIÓN DE NOMBRE(S), APELLIDO(S) Y/O MODIFICACION DE FECHA DE NACIMIENTO</h4>
                                                        </div>
                                                        <div class="modal-body">

                                                           <form>
                                                              <div class="form-row">
                                                                <div class="form-group col-md-4">
                                                                  <label for="inputEmail4">Carnet Identidad</label>
                                                                  <input type="input" class="form-control" id="" placeholder="Carnet Identidad" v-model="dataStudentModif.carnetIdentidad">
                                                                </div>
                                                                <div class="form-group col-md-4">
                                                                  <label for="complemento">Complemento</label>
                                                                  <input type="input" class="form-control" id="Complemento" placeholder="Complemento" v-model="dataStudentModif.complemento">
                                                                </div>
                                                                <div class="form-group col-md-4">
                                                                  <label for="Fecha">Fecha Nacimiento</label>
                                                                  <input type="input" class="form-control" id="complemento" placeholder="Fecha Nacimiento" v-model="dataStudentModif.fechaNacimiento">
                                                                </div>
                                                              </div>

                                                              <div class="form-row">
                                                                <div class="form-group col-md-4">
                                                                  <label for="inputEmail4">Paterno</label>
                                                                  <input type="input" class="form-control" id="inputEmail4" placeholder="Paterno" v-model="dataStudentModif.paterno">
                                                                </div>
                                                                <div class="form-group col-md-4">
                                                                  <label for="Materno">Materno</label>
                                                                  <input type="input" class="form-control" id="materno" placeholder="Materno" v-model="dataStudentModif.materno">
                                                                </div>
                                                                <div class="form-group col-md-4">
                                                                  <label for="Nombre(s)">Nombre(s)</label>
                                                                  <input type="input" class="form-control" id="nombres" placeholder="Nombre(s)" v-model="dataStudentModif.nombre">
                                                                </div>
                                                              </div>
                                                              
                                                              <button type="button" class="btn btn-primary" v-on:click="registryFormOne();">verifica</button>
                                                              <button type="button" class="btn btn-danger" v-on:click="clearSegip();">Cancelar</button>
                                                              </br>
                                                              </br>
                                                                <div class="alert alert-danger" v-if="responseSegip==1">
                                                                    <strong>Alerta:</strong> validation segip incorrecta, datos no modificados!!!
                                                                </div>                                                              
                                                                <div class="alert alert-success" v-if="responseSegip==2">
                                                                    <strong>BIEN:</strong> validation segip correcta!!!
                                                                </div>
                                                                <div class="alert alert-danger" v-if="responseSegip==3">
                                                                    <strong>Alerta:</strong>   No se detectan cambios!!!
                                                                </div>                                                                
                                                              <p v-else="responseSegip==''" class="label red"></p>
                                                            </form>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="modal fade" id="modalEstudianteTwo" data-backdrop="static">
                                                <div class="modal-dialog" style="width:800px">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                                            <h4 class="modal-title">MODIFICACIÓN Y/O INCLUSIÓN DE DATOS PROPIOS DEL CERTIFICADO DE NACIMIENTO</h4>
                                                        </div>
                                                        <div class="modal-body">

                                                           <form>
                                                              <div class="form-row">
                                                                <div class="form-group col-md-6">
                                                                  <label for="inputEmail4">Genero</label>

                                                                  <select name="arrGenero" id="idarrGenero" v-model="dataStudentModif.generoTipoId" class="custom-select form-control" v-on:change="setGenero();">  
                                                                    <option v-for="item in DBGenero"  :value="item.generoId">${ item.genero }</option>       
                                                                  </select>
                                                                </div>

                                                                <div class="form-group col-md-6">
                                                                  <label for="Nombre(s)">Pasaporte</label>
                                                                  <input type="input" class="form-control" id="" placeholder="" v-model="dataStudentModif.pasaporte">
                                                                </div>                                                              
                                                                
                                                              </div>

                                                              <div class="form-row">
                                                                <div class="form-group col-md-2">
                                                                  <label for="inputEmail4">pais</label>
                                                                  
                                                                  <select name="arrPais" id="idarrPais" v-model="dataStudentModif.paisId" class="custom-select form-control" v-on:change="setPais();">  
                                                                    <option v-for="item in DBPais"  :value="item.paisId">${ item.pais }</option>       
                                                                  </select>
                                                                </div>
                                                                <div class="form-group col-md-3">
                                                                  <label for="Materno">Departamento</label>

                                                                  <select name="arrPais" id="idarrPais" v-model="dataStudentModif.lugarNacTipoId" class="custom-select form-control" v-on:change="setDepto();">  
                                                                    <option v-for="item in DBDepto"  :value="item.deptoId">${ item.depto }</option>
                                                                  </select>

                                                                </div>
                                                                <div class="form-group col-md-3">
                                                                  <label for="Nombre(s)">Provincia</label>
                                                                  
                                                                  <select name="arrPais" id="idarrPais" v-model="dataStudentModif.lugarProvNacTipoId" class="custom-select form-control" v-on:change="setProvincia();">  
                                                                    <option v-for="item in DBProvincia"  :value="item.provinciaId">${ item.provincia }</option>
                                                                  </select>

                                                                </div>
                                                                <div class="form-group col-md-4">
                                                                  <label for="Nombre(s)">Localidad</label>
                                                                  <input type="input" class="form-control" id="" placeholder="" v-model="dataStudentModif.localidad">
                                                                </div>
                                                              </div>

                                                              <div class="form-row">
                                                                <div class="form-group col-md-2">
                                                                  <label for="inputEmail4">Oficialia</label>
                                                                  <input type="input" class="form-control" id="" placeholder="" v-model="dataStudentModif.oficialia">
                                                                </div>
                                                                <div class="form-group col-md-3">
                                                                  <label for="Materno">Libro</label>
                                                                  <input type="input" class="form-control" id="" placeholder="" v-model="dataStudentModif.libro">
                                                                </div>
                                                                <div class="form-group col-md-3">
                                                                  <label for="Nombre(s)">Partida</label>
                                                                  <input type="input" class="form-control" id="" placeholder="" v-model="dataStudentModif.partida">
                                                                </div>
                                                                <div class="form-group col-md-4">
                                                                  <label for="Nombre(s)">Folio</label>
                                                                  <input type="input" class="form-control" id="" placeholder="" v-model="dataStudentModif.folio">
                                                                </div>
                                                              </div>

                                                              <button type="button" class="btn btn-primary" v-on:click="registryFormTwo();">Registro Previo</button>
                                                              <button type="button" class="btn btn-danger" v-on:click="clearFormTwo();">Cancelar</button>
                                                              </br>
                                                              </br>
                                                               <div class="alert alert-danger" v-if="responseFormTwo!=''">
                                                                    <strong>Alerta:</strong> No existe cambios en el formulario...
                                                               </div>   
                                                            </form>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>



                              <!-- </div> -->
                            </div>
                  
                       
                    </div>
                </div>
                <div id="dataStudent"></div>
            </div>
        </div>

</div>
</div>

{% endblock %}
{% block javascripts%}
    {{parent()}}
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.15.2/axios.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>   
    <script>
        var app = new Vue({
            delimiters: ['${', '}'],
            el: '#app',
            data: {
                codigoRude:'',
                gestion:'',
                item:'',
                arraOptionBuscar:'',
                rudeBuscar:'',
                optionBuscar:'',
                studentId:'',
                buscando:false,
                swOne:false,
                swTwo:false,
                responseSegip:'',
                responseFormTwo:'',
                respuesta:'',
                dataStudent: {},
                dataStudentModif: {},                            
                DBGenero: {},
                DBPais: {},
                DBDepto: {},
                DBProvincia: {},
                dataModifyToSend:[],
                archivoAdjunto:'',
                informe:'',
                showbuttonPDF:false,
                swCertification:false,

               
            },
            methods: {
                buscarEstudiante: function(){
                    this.buscando = true;
                    this.studentId = false;
                    this.codigoRude = '';
                    this.estudiante = '';
                    this.respuesta = '';
                    this.arraOptionBuscar = '';
                    this.item = '';
                    this.informe = '';
                    this.showbuttonPDF=false;
                    this.swOne=false;
                    this.swTwo=false;                    

                    if (this.rudeBuscar.length == 0) {
                        this.respuesta = 'Debe ingresar un código RUDE válido';
                        this.buscando = false;
                        return;
                    }

                    if (this.rudeBuscar.length < 13) {
                        this.respuesta = 'El código RUDE ingresado no es válido';
                        this.buscando = false;
                        return;
                    }
                    if(this.optionBuscar < 0){
                        this.respuesta = 'Debe ingresar un opcion de busqueda';
                        this.buscando = false;
                        return;
                    }

                    axios.get(Routing.generate('specialmodificationdata_student_lookfor_student', {
                        codigoRude: this.rudeBuscar,
                        arraOptionBuscar: this.optionBuscar                        
                    }))
                    .then(response => {
                        if (response.status == 200) {

                            if(response.data.swerror){
                                this.codigoRude = response.data.codigoRude;
                                this.estudiante = response.data.estudiante;
                                this.studentId = response.data.studentId;
                                this.dataStudent = response.data.student;
                                this.dataStudentModif = response.data.studentModif;
                                this.DBGenero = response.data.arrGenero;
                                this.DBPais = response.data.arrPais;
                                this.DBDepto = response.data.arrDepto;
                                this.DBProvincia = response.data.arrProvincia;
                                this.swCertification = response.data.swCertification;
                                this.buscando = false;
                                
                                /*console.log(this.dataStudent);*/
                                $('[data-toggle="tooltip"]').tooltip();
                            }else{
                                this.codigoRude = '';
                                this.estudiante = '';
                                this.studentId = '';
                                this.dataStudent = '';
                                this.dataStudentModif = '';
                                this.DBGenero = '';
                                this.DBPais = '';
                                this.DBDepto = '';
                                this.DBProvincia = '';
                                
                                this.buscando = false;
                                this.respuesta = response.data.message;
                                this.buscando = false;
                                this.swCertification = false;
                                return;
                            }
                        }
                        if( response.status == 202){
                            this.respuesta = response.data;
                        }

                        this.buscando = false;
                    })
                    .catch(e => {
                        console.log(e);
                        this.buscando = false;
                    });
                },
                setGenero: function(){
                    var me = this;
                    $.each(this.DBGenero, function (i, value) {
                        if(me.dataStudentModif.generoTipoId == value.generoId) {
                            me.dataStudentModif.generoTipo = value.genero;
                        }
                    });                    
                },
                setPais: function(){
                    var me = this;
                    
                    $.each(this.DBPais, function (i, value) {
                        if(me.dataStudentModif.paisId == value.paisId) {
                            me.dataStudentModif.pais = value.pais;
                            me.dataModifyToSend.push({'paisId':me.dataStudentModif.paisId})
                        }
                    });
                    
                    if(me.dataStudentModif.paisId == 1){
                         axios.post(Routing.generate('specialmodificationdata_get_depto', me.dataStudentModif ))
                            .then(response => {
                                if (response.status == 200) {
                                    this.DBDepto = response.data.arrDepto;
                                    $('[data-toggle="tooltip"]').tooltip();
                                }
                                if( response.status == 202){
                                    this.respuesta = response.data;
                                }

                                this.buscando = false;
                            })
                            .catch(e => {
                                console.log(e);
                                this.buscando = false;
                            });
                    }else{
                        this.DBDepto = '';
                        this.DBProvincia = '';
                        me.dataStudentModif.lugarNacTipoId ='';
                        me.dataStudentModif.lugarProvNacTipoId ='';
                    }
                    
                },
                setDepto: function(){
                    var me = this;
                    $.each(this.DBDepto, function (i, value) {
                        if(me.dataStudentModif.lugarNacTipoId == value.deptoId) {
                            me.dataStudentModif.lugarNacTipo = value.depto;
                            /*me.dataModifyToSend.push({'lugarNacTipoId':me.dataStudentModif.lugarNacTipoId});*/
                        }                        
                    });  
                    
                    if(me.dataStudentModif.paisId == 1 && me.dataStudentModif.lugarNacTipoId>0){
                         axios.post(Routing.generate('specialmodificationdata_get_provincia', me.dataStudentModif ))
                            .then(response => {
                                if (response.status == 200) {
                                    this.DBProvincia = response.data.arrProvincia;
                                    $('[data-toggle="tooltip"]').tooltip();
                                }
                                if( response.status == 202){
                                    this.respuesta = response.data;
                                }

                                this.buscando = false;
                            })
                            .catch(e => {
                                console.log(e);
                                this.buscando = false;
                            });
                    }else{
                        this.DBDepto = '';
                        this.DBProvincia = '';
                        me.dataStudentModif.lugarNacTipoId ='';
                        me.dataStudentModif.lugarProvNacTipoId ='';
                    }





                },
                setProvincia: function(){
                    var me = this;
                    $.each(this.DBProvincia, function (i, value) {
                        if(me.dataStudentModif.lugarProvNacTipoId == value.provinciaId) {
                            me.dataStudentModif.lugarProvNacTipo = value.provincia;
                            me.dataModifyToSend.push({'provinciaId':me.dataStudentModif.lugarProvNacTipoId})
                        }
                    });                    
                },                 
                               

                registryFormOne: function(){
                    var sw = false;
                    this.responseSegip='';

                    if(this.dataStudentModif.carnetIdentidad != this.dataStudent.carnetIdentidad)sw = true;
                    if(this.dataStudentModif.complemento != this.dataStudent.complemento)sw = true;
                    if(this.dataStudentModif.fechaNacimiento != this.dataStudent.fechaNacimiento)sw = true;
                    if(this.dataStudentModif.paterno != this.dataStudent.paterno)sw = true;
                    if(this.dataStudentModif.materno != this.dataStudent.materno)sw = true;
                    if(this.dataStudentModif.nombre != this.dataStudent.nombre)sw = true;
                        
                    if(sw){

                        axios.get(Routing.generate('specialmodificationdata_val_segip', {
                            carnet: this.dataStudentModif.carnetIdentidad,
                            complemento: this.dataStudentModif.complemento,                        
                            fechaNacimiento: this.dataStudentModif.fechaNacimiento,                        
                            paterno: this.dataStudentModif.paterno,                        
                            materno: this.dataStudentModif.materno,                        
                            nombre: this.dataStudentModif.nombre
                        }))
                        .then(response => {
                            if (response.status == 200) {
                                this.responseSegip=1;
                                this.swOne = false;
                                if(response.data.answerSegip){
                                    // the data student is correct
                                    this.responseSegip=2;
                                    this.swOne = true;
                                    $('#modalEstudianteOne').modal('hide');
                                }
                                console.log(response.data.answerSegip);
                                $('[data-toggle="tooltip"]').tooltip();
                            }
                            if( response.status == 202){
                                this.respuesta = response.data;
                            }

                            this.buscando = false;
                        })
                        .catch(e => {
                            console.log(e);
                            this.buscando = false;
                        });
                    }else{
                        this.responseSegip='';
                        console.log('no change');
                        this.responseSegip=3;
                        this.swOne = false;
                        // disable button
                    }
                    // this.swOne = sw;


                },
                clearSegip: function(){
                    this.responseSegip='';
                    this.dataStudentModif.carnetIdentidad = this.dataStudent.carnetIdentidad;
                    this.dataStudentModif.complemento = this.dataStudent.complemento;
                    this.dataStudentModif.fechaNacimiento = this.dataStudent.fechaNacimiento;
                    this.dataStudentModif.paterno = this.dataStudent.paterno;
                    this.dataStudentModif.materno = this.dataStudent.materno;
                    this.dataStudentModif.nombre = this.dataStudent.nombre;
                    this.swOne=false;
                    $('#modalEstudianteOne').modal('hide');

                },
                registryFormTwo: function(){
                    var sw=false;
                    if(this.dataStudentModif.generoTipo != this.dataStudent.generoTipo)sw = true;
                    if(this.dataStudentModif.pais != this.dataStudent.pais)sw = true;
                    if(this.dataStudentModif.lugarNacTipo != this.dataStudent.lugarNacTipo)sw = true;
                    if(this.dataStudentModif.lugarProvNacTipo != this.dataStudent.lugarProvNacTipo)sw = true;
                    if(this.dataStudentModif.localidad != this.dataStudent.localidad)sw = true;
                    if(this.dataStudentModif.oficialia != this.dataStudent.oficialia)sw = true;
                    if(this.dataStudentModif.libro != this.dataStudent.libro)sw = true;
                    if(this.dataStudentModif.partida != this.dataStudent.partida)sw = true;
                    if(this.dataStudentModif.folio != this.dataStudent.folio)sw = true;
                    if(this.dataStudentModif.pasaporte != this.dataStudent.pasaporte)sw = true;

                    if(sw){
                        this.swTwo = true;
                        $('#modalEstudianteTwo').modal('hide');
                    }else{
                        this.swTwo = false;
                        this.responseFormTwo='no existen cambios';
                    }

                },
                clearFormTwo: function(){

                    this.dataStudentModif.generoTipo = this.dataStudent.generoTipo;
                    this.dataStudentModif.pais = this.dataStudent.pais;
                    this.dataStudentModif.lugarNacTipo = this.dataStudent.lugarNacTipo;
                    this.dataStudentModif.lugarProvNacTipo = this.dataStudent.lugarProvNacTipo;
                    this.dataStudentModif.localidad = this.dataStudent.localidad;
                    this.dataStudentModif.oficialia = this.dataStudent.oficialia;
                    this.dataStudentModif.libro = this.dataStudent.libro;
                    this.dataStudentModif.partida = this.dataStudent.partida;
                    this.dataStudentModif.folio = this.dataStudent.folio;
                    this.dataStudentModif.pasaporte = this.dataStudent.pasaporte;
                    this.swTwo = false;
                    $('#modalEstudianteTwo').modal('hide');

                },
                updateStudent: function(){

                  
                    console.log(this.swCertification);
                    if(this.swCertification){

                          /*console.log(this.dataStudentModif.resolucionAdm);*/
                        if(this.dataStudentModif.resolucionAdm == ''){
                            this.respuesta = 'Debe ingresar la Resolucion Administrativa';
                            this.buscando = false;
                            Swal.fire(
                                'Debe ingresar la Resolucion Administrativa',
                                'Campo requerido!',                              
                                'warning'
                                );                        
                            return false;
                        }

                        if(this.dataStudentModif.fecharesolAdm == ''){
                        this.respuesta = 'Debe ingresar la Fecha de Resolucion Administrativa';
                        this.buscando = false;
                        Swal.fire(
                              'Debe ingresar la Fecha de Resolucion Administrativa',
                              'Campo requerido!',                              
                              'warning'
                            );                        
                        return false;
                        }
                        if(this.dataStudentModif.justificativo == ''){
                            this.respuesta = 'Debe ingresar el Justificativo';
                            this.buscando = false;
                            Swal.fire(
                                'Debe ingresar el Justificativo',
                                'Campo requerido!',                              
                                'warning'
                                );                        
                            return false;
                        }

                        /*validate the file attached*/
                        if (typeof this.informe != 'object') {
                            Swal.fire(
                            'Adjuntar Resolucion Administrativa',
                            'Debe adjuntar un escaneado de la RA, puede ser un archivo de imagen o PDF',
                            'warning'
                            );
                            return;
                        }
                    }else{
                       this.informe = ''; 
                    }
                    
                    Swal.fire({
                        title: '¿Enviar Cambios?',
                        text: "esta seguro de realizar los cambios",
                        type: 'question',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Si, proceder',
                        cancelButtonText: 'Cancelar'
                    }).then((result) => {
                        if (result.value) {
                            var data = new FormData();
                            data.append('datos', JSON.stringify(this.dataStudentModif));
                            data.append('informe', this.informe);
                                                        
                             axios.post(Routing.generate('specialmodificationdata_update_student'), data)
                            .then(response => {
                                if (response.status == 200) {
                                    this.showbuttonPDF = false;
                                    if(response.data.showbuttonPDF){
                                       this.showbuttonPDF = response.data.showbuttonPDF
                                    }
                                    console.log(response.data.answerSegip);
                                    $('[data-toggle="tooltip"]').tooltip();
                                }
                                if( response.status == 202){
                                    this.respuesta = response.data;
                                }
                                this.buscando = false;
                            })
                            .catch(e => {
                                console.log(e);
                                this.buscando = false;
                            });

                            
                        }
                    })                   

                },
                cancelupdateStudent: function(){

                    this.respuesta = 'Modificacion cancelada';
                    this.buscando = false;
                    this.studentId = '';
                    this.swOne=false;
                    this.swTwo=false;

                    this.dataStudentModif.generoTipo = this.dataStudent.generoTipo;
                    this.dataStudentModif.pais = this.dataStudent.pais;
                    this.dataStudentModif.lugarNacTipo = this.dataStudent.lugarNacTipo;
                    this.dataStudentModif.lugarProvNacTipo = this.dataStudent.lugarProvNacTipo;
                    this.dataStudentModif.localidad = this.dataStudent.localidad;
                    this.dataStudentModif.oficialia = this.dataStudent.oficialia;
                    this.dataStudentModif.libro = this.dataStudent.libro;
                    this.dataStudentModif.partida = this.dataStudent.partida;
                    this.dataStudentModif.folio = this.dataStudent.folio;
                    this.dataStudentModif.pasaporte = this.dataStudent.pasaporte;

                    this.responseSegip='';
                    this.dataStudentModif.carnetIdentidad = this.dataStudent.carnetIdentidad;
                    this.dataStudentModif.complemento = this.dataStudent.complemento;
                    this.dataStudentModif.fechaNacimiento = this.dataStudent.fechaNacimiento;
                    this.dataStudentModif.paterno = this.dataStudent.paterno;
                    this.dataStudentModif.materno = this.dataStudent.materno;
                    this.dataStudentModif.nombre = this.dataStudent.nombre;                    

                    return false;

                },
                getImage: function(event){
                    var informe = event.target.files[0];
                    var allowedExtensions = /(.jpg|.jpeg|.png|.gif|.pdf)$/i;
                    if(!allowedExtensions.exec(event.target.value)){
                        event.target.value = '';
                        Swal.fire(
                              'Archivo incorrecto!',
                              'El archivo adjunto debe ser una imagen o un archivo pdf',
                              'warning'
                            );
                        this.informe = '';
                        return false;
                    }else{
                        var megas = (informe.size / 1024)/1024;
                        if (megas > 2) {
                            event.target.value = '';
                            Swal.fire(
                              'Tamaño no permitido!',
                              'El archivo debe tener un tamaño menor a 2MB',
                              'warning'
                            );
                            this.informe = '';
                            return false;
                        }
                    }
                    this.informe = event.target.files[0];
                },                

            },
            mounted(){
                
            }
        });

        $(document).ready(function(){
            $('[data-toggle="tooltip"]').tooltip();
            $("td").focus();
        });        
























        var lookforStudent = function () {
            //get the values
           var rude = $('#form_codeRude').val();
           var selectOption = $('#form_arrOption').val();
            
            if (rude.length <= 0) {
                alert("Necesita código RUDE para realizar la busqueda");
                return false;
            }
            if (selectOption == '') {
                alert("Necesita seleccionar criterio de busqueda");
                return false;
            }
            
            dataForm = $('#idFormFindStudent').serialize();
            $.ajax({
                type: 'post',
                data: dataForm,
                url: Routing.generate('specialmodificationdata_student_lookfor_student'),
                beforeSend: function () {
                    $("#dataStudent").empty();
                    $("#dataStudent").append('<div class="text-center"><img src="{{asset('img/loading.gif')}}" class="loading img-responsive" /></div>');
                },
                success: function (data) {
                    $("#dataStudent").empty();
                    $("#dataStudent").append(data);
                },
                statusCode: {
                    500: function () {

                    },
                    404: function () {

                    }
                }
            });
        }

                // formdataId
        var updateDataStudent = function(){
            var message = '';
            if($('#form_resoladm').val()==''){
                message+= '- Necesita Resolucion Administrativa\n';
            }
            if($('#form_fecharesoladm').val()==''){
                message+= '- Necesita Fecha Resolucion Administrativa\n';
            }
            if($('#form_obs').val()==''){
                message+= '- Necesita registrar justificativo\n';
            }            
            if(message){
                alert(message);
                return false;
            }
            if(!validarFormatoFecha($('#form_fecharesoladm').val())){
              alert('Revise formato de Fecha Resolucion Administrativa (dd-mm-aaaa)');
              return false;
            }
            
            var dataForm = $('#formdataStudentId').serialize();
            if (confirm('¿Esta seguro de realizar el cambio?')) {
                    $.ajax({
                        type: 'post',
                        data: dataForm,
                        url: Routing.generate('specialmodificationdata_student_updateDataStudent'),
                        beforeSend: function () {
                            $("#dataStudent").empty();
                            $("#dataStudent").append('<div class="text-center"><img src="{{asset('img/loading.gif')}}" class="loading img-responsive" /></div>');
                        },
                        success: function (data) {
                            
                            $("#dataStudent").empty();
                            $("#dataStudent").append(data);
                        },
                        statusCode: {
                            500: function () {

                            },
                            404: function () {

                            }
                        }
                    });
            } else {
              return false;
            }
        }


function validarFormatoFecha(campo) {
      var RegExPattern = /^\d{1,2}\-\d{1,2}\-\d{4}$/;
      if ((campo.match(RegExPattern)) && (campo!='')) {
            return true;
      } else {
            return false;
      }
}        


        function dep(es) {

            $.ajax({
                type: 'get',
                url: Routing.generate('search_departamentos_st', {'pais': parseInt(es)}),
                beforeSend: function () {
                    $("#form_departamento").empty();
                    $("#form_provincia").empty();
                    /*$("#localidad").empty();*/
                    $("#div-load").parent().append('<div class="loading"></div>');
                },
                success: function (data) {
                    $("#form_departamento").empty();
                    $("#form_provincia").empty();

                    $.each(data.departamento, function (i, value) {
                        $("#form_departamento").append('<option value="' + i + '">' + value + '</option>');
                    });
                    $(".loading").remove();
                }
            });
        }



        function prov(d) {
            $.ajax({
                type: 'get',
                url: Routing.generate('search_provincias_st', {'departamento': parseInt(d)}),
                beforeSend: function () {
                    $("#form_provincia").empty();
                    $("#div-load-prov").parent().append('<div class="loading"></div>');
                },
                success: function (data) {
                    $("#form_provincia").empty();
                    $.each(data.provincia, function (i, value) {
                        $("#form_provincia").append('<option value="' + i + '">' + value + '</option>');
                    });
                    $(".loading").remove();
                }
            });
        }        








    </script>
{%endblock%}
