{% extends 'layoutRegular.html.twig' %}
{% block stylesheets %}
    {{parent()}}
    <link href="{{asset('css/chosen.css')}}" rel="stylesheet">
    <link href="{{asset('bootstrap-wizard/css/bwizard.min.css')}}" rel="stylesheet">
    <style>
    .arrow-before {
        width:0px;
        height:0px;
        border-left: 6px solid transparent;  /* izquierda flecha */
        border-right: 6px solid transparent; /* derecha flecha */
        border-bottom: 6px solid #906094; /* base flecha y color*/
        font-size:0px;
        line-height:0px;
        top: 6px;
        left: 3px;
        position: relative;
    }
    .arrow-after {
        width:0px;
        height:0px;
        border-left: 6px solid transparent;  /* izquierda flecha */
        border-right: 6px solid transparent; /* derecha flecha */
        border-bottom: 6px solid #906094; /* base flecha y color*/
        font-size:0px;
        line-height:0px;
        top: 1px;
        left: 3px;
        position: relative;
    }
    #popover-head{
        width: 300px;
        background-color: #6E89FF;
    }
</style>
{% endblock %}
{% block contentoption %}

    <div class="row">
        <div class="col-lg-12">
            <div class="page-title">
                <h1>{{ app.session.get('tituloTipo') }}
                    <small></small>
                </h1>
                <ol class="breadcrumb">
                    <li><i class="fa fa-search"></i>  <a href="{{path('creacion_cursos_solicitud')}}">Buscar</a></li>
                    <li><i class="fa fa-list"></i>  <a href="{{path('areas',{'op':'result'})}}">{{ app.session.get('tituloTipo') }}</a>
                    </li>
                </ol>
            </div>
        </div>
        <!-- /.col-lg-12 -->
    </div>
    <div class="row">
        <div class="col-md-12">
            {% for flashMessage in app.session.flashbag.get('newError') %}
                <div class="alert alert-danger" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    {{ flashMessage }}
                </div>
            {% endfor %}
            {% for flashMessage in app.session.flashbag.get('updateOk') %}
                <div class="alert alert-success" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    {{ flashMessage }}
                </div>
            {% endfor %}
            {% for flashMessage in app.session.flashbag.get('updateError') %}
                <div class="alert alert-danger" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    {{ flashMessage }}
                </div>
            {% endfor %}
            {% for flashMessage in app.session.flashbag.get('deleteOk') %}
                <div class="alert alert-success" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    {{ flashMessage }}
                </div>
            {% endfor %}
            {% for flashMessage in app.session.flashbag.get('deleteError') %}
                <div class="alert alert-danger" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    {{ flashMessage }}
                </div>
            {% endfor %}
            <!--  cursos -->
            {% for flashMessage in app.session.flashbag.get('newCursoOk') %}
                <div class="alert alert-success" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    {{ flashMessage }}
                </div>
            {% endfor %}
            {% for flashMessage in app.session.flashbag.get('newCursoError') %}
                <div class="alert alert-danger" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    {{ flashMessage }}
                </div>
            {% endfor %}
            {% for flashMessage in app.session.flashbag.get('deleteCursoOk') %}
                <div class="alert alert-success" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    {{ flashMessage }}
                </div>
            {% endfor %}
            {% for flashMessage in app.session.flashbag.get('deleteCursoError') %}
                <div class="alert alert-danger" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    {{ flashMessage }}
                </div>
            {% endfor %}
        </div>
    </div>
     
    <div class="row">
        <div class="col-lg-12">
            <div class="portlet portlet-blue">
                <div class="portlet-heading">
                    <div class="portlet-title">
                        <h4>Institución Educativa - <small style="color:#C3FDEA;">{{tipoUE.tipo}}</small> </h4>
                    </div>
                    <div class="portlet-widgets">
                        <a data-toggle="collapse" data-parent="#accordion" href="basic-form-elements.html#panelinstitucion"><i class="fa fa-chevron-down"></i></a>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <div id="panelinstitucion" class="panel-collapse collapse in">
                    <div class="portlet-body">
                        <div class="panel-body panel-primary">
                            <div id="no-more-tables">
                                <table class="table table-bordered cf">
                                    <thead class="cf">
                                        <tr>
                                            <th>Código SIE</th>
                                            <th>Nombre</th>
                                            <th>Gestión</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    <td data-title="Código SIE">{{institucion.id}}</td>
                                    <td data-title="Ins.Educativa">{{institucion.institucioneducativa}}</td>
                                    <td data-title="Gestión"><span class="label purple">{{gestion}}</span></td>
                                    </tbody>
                                </table>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
   

    <div class="row">
        <div class="col-lg-12">
            <div class="portlet portlet-blue">
                <div class="portlet-heading">
                    <div class="portlet-title">
                        <h4>Cursos Existentes</h4>
                    </div>
                    <div class="portlet-widgets">
                        <a data-toggle="collapse" href="basic-form-elements.html#panelAreas"><i class="fa fa-chevron-down"></i></a>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <div id="panelAreas" class="panel-collapse collapse in">
                    <div class="portlet-body">
                        <div id="divMensaje"></div>
                        <div id="divAreas">
                            Debe seleccionar un curso
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <div class="portlet portlet-green">
                <div class="portlet-heading">
                    <div class="portlet-title">
                        <h4>CREAR NUEVO CURSO</h4>
                    </div>
                    <div class="portlet-widgets">
                        <a data-toggle="collapse" data-parent="#accordion" href="basic-form-elements.html#panelinstitucion"><i class="fa fa-chevron-down"></i></a>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <div id="panelinstitucion2" class="panel-collapse collapse in">
                    <div class="portlet-body">
                        <div class="panel-body panel-primary">
                            
                            <div style="background: #EEE; padding:3px 10px 10px 10px">                               
                                {{form_start(formNuevo,{'attr':{'id':'formCursos','onsubmit':'return validateFormNuevoCurso()'} })}}
                                <div class="row">
                                    <div class="col-lg-3 col-md-6">
                                        {{form_label(formNuevo.nuevoTurno)}}
                                        {{form_widget(formNuevo.nuevoTurno)}}
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        {{form_label(formNuevo.nuevoNivel)}}
                                        {{form_widget(formNuevo.nuevoNivel)}}
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        {{form_label(formNuevo.nuevoGrado)}}
                                        {{form_widget(formNuevo.nuevoGrado)}}
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        {{form_label(formNuevo.nuevoParalelo)}}
                                        {{form_widget(formNuevo.nuevoParalelo)}}
                                    </div>
                                    {# <div class="col-lg-2 col-md-6">
                                        {{form_label(formNuevo.nuevoAncho)}}
                                        {{form_widget(formNuevo.nuevoAncho)}}
                                    </div>
                                    <div class="col-lg-2 col-md-6">
                                        {{form_label(formNuevo.nuevoLargo)}}
                                        {{form_widget(formNuevo.nuevoLargo)}}
                                    </div> #}
                                    <div class="col-lg-4 col-lg-offset-4" style="text-align:center;">
                                        <br>                                       
                                        {{form_widget(formNuevo.crear)}}
                                    </div>
                                </div>
                                {{form_end(formNuevo)}}
                            </div>

                             <div id="divNuevoCurso">
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <div class="portlet portlet-blue">
                <div class="portlet-heading">
                    <div class="portlet-title">
                        <h4>Cursos Nuevos Solicitado</h4>
                    </div>
                    <div class="portlet-widgets">
                        <a data-toggle="collapse" href="basic-form-elements.html#panelNewCurso"><i class="fa fa-chevron-down"></i></a>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <div id="panelNewCursos" class="panel-collapse collapse in">
                    <div class="portlet-body">
                        <div id="divMensaje"></div>
                        <div id="divNewCurso">
                            Sin solicitudes
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    

    <div class="modal modal-flex fade" id="newModal" tabindex="-1" role="dialog" aria-labelledby="flexModalLabel" aria-hidden="true" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <form name="formAreasModal" id="formAreasModal" action="" onsubmit="enviarAreas();
                        return false">
                    <input type="hidden" name="divResultado" id="divResultado">
                    <input type="hidden" name="idInstitucionCurso" id="idInstitucionCurso">
                    <input type="hidden" name="idNivel" id="idNivel">
                    <input type="hidden" name="educacionTipo" id="educacionTipo" value="{{app.session.get('sysname')}}">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h4 class="modal-title" id="flexModalLabel">Adición de áreas</h4>
                        <span id="nivelModal"></span>
                        - <span id="gradoModal"></span>
                        - <span id="paraleloModal"></span>
                    </div>
                    <div class="modal-body">
                        <div id="areasModal">

                        </div>
                    </div>

                </form>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
{% endblock %}
{% block javascripts %}
    {{parent()}}
    <script src="{{asset('js/chosen.jquery.js')}}"></script>
    <script src="{{asset('bootstrap-wizard/js/bwizard.js')}}"></script>
    <script src="{{asset('bootstrap-wizard/jquery-ui.min.js')}}"></script>
    <script>

                    var xhr2;
                    var xhr3;
                    var xhr4;
                    var openList = cargarSolicitudesForm();
                    function cargarNiveles() {
                        var institucion = $('#form_idInstitucion').val();
                        var gestion = $('#form_idGestion').val();
                        var turno = $('#form_turno').val();
                        if (xhr2 && xhr2.readyState != 4) {
                            xhr2.abort();
                        }
                        xhr2 = $.ajax({
                            type: 'get',
                            url: Routing.generate('creacion_cursos_solicitud_cargar_niveles', {'idInstitucion': institucion, 'gestion': gestion, 'turno': turno}),
                            beforeSend: function () {
                                $("#form_nivel").empty();
                                $("#form_grado").empty();
                                $("#form_paralelo").empty();
                                $("#form_nivel").append('<option value="">Buscando...</option>');
                                $("#form_grado").append('<option value="">Buscando...</option>');
                                $("#form_paralelo").append('<option value="">Buscando...</option>');
                                $('#divAreas').empty();
                            },
                            success: function (data) {
                                $("#form_nivel").empty();
                                $("#form_grado").empty();
                                $("#form_paralelo").empty();
                                $("#form_nivel").append('<option value="">Seleccionar...</option>');
                                $("#form_grado").append('<option value="">Seleccionar...</option>');
                                $("#form_paralelo").append('<option value="">Seleccionar...</option>');
                                $.each(data.niveles, function (i, value) {
                                    $("#form_nivel").append('<option value="' + i + '">' + value + '</option>');
                                });
                            }
                        });
                    }

                    function cargarNiveles2() {
                        
                        var institucion = $('#form_idInstitucion').val();
                        var gestion = $('#form_idGestion').val();
                        var turno = $('#form_nuevoTurno').val();
                       
                        if (xhr2 && xhr2.readyState != 4) {
                            xhr2.abort();
                        }
                        xhr2 = $.ajax({
                            type: 'get',
                            url: Routing.generate('areas_cargar_niveles', {'idInstitucion': institucion, 'gestion': gestion, 'turno': turno}),
                            beforeSend: function () {
                                $("#form_nuevoNivel").empty();
                                $("#form_nuevoGrado").empty();
                                //$("#form_nuevoParalelo").empty();
                                $("#form_nuevoNivel").append('<option value="">Buscando...</option>');
                                $("#form_nuevoGrado").append('<option value="">Buscando...</option>');
                                //$("#form_nuevoParalelo").append('<option value="">Buscando...</option>');
                                $('#divAreas').empty();
                            },
                            success: function (data) {
                                $("#form_nuevoNivel").empty();
                                $("#form_nuevoGrado").empty();
                                //$("#form_nuevoParalelo").empty();
                                $("#form_nuevoNivel").append('<option value="">Seleccionar...</option>');
                                $("#form_nuevoGrado").append('<option value="">Seleccionar...</option>');
                                //$("#form_Paralelo").append('<option value="">Seleccionar...</option>');
                                $.each(data.niveles, function (i, value) {
                                    $("#form_nuevoNivel").append('<option value="' + i + '">' + value + '</option>');
                                });
                            }
                        });
                    }

                    function cargarGrados() {
                        var institucion = $('#form_idInstitucion').val();
                        var gestion = $('#form_idGestion').val();
                        var turno = $('#form_turno').val();
                        var nivel = $('#form_nivel').val();
                        if (xhr3 && xhr3.readyState != 4) {
                            xhr3.abort();
                        }
                        xhr3 = $.ajax({
                            type: 'get',
                            url: Routing.generate('creacion_cursos_solicitud_cargar_grados', {'idInstitucion': institucion, 'gestion': gestion, 'turno': turno, 'nivel': nivel}),
                            beforeSend: function () {
                                $("#form_grado").empty();
                                $("#form_paralelo").empty();
                                $("#form_grado").append('<option value="">Buscando...</option>');
                                $("#form_paralelo").append('<option value="">Buscando...</option>');
                                $('#divAreas').empty();
                            },
                            success: function (data) {
                                $("#form_grado").empty();
                                $("#form_paralelo").empty();
                                $("#form_grado").append('<option value="">Seleccionar...</option>');
                                $("#form_paralelo").append('<option value="">Seleccionar...</option>');
                                $.each(data.grados, function (i, value) {cargarParalelos
                                    $("#form_grado").append('<option value="' + i + '">' + value + '</option>');
                                });

                            }
                        });
                    }

                    function cargarGrados2() {
                        var institucion = $('#form_idInstitucion').val();
                        var gestion = $('#form_idGestion').val();
                        var turno = $('#form_nuevoTurno').val();
                        var nivel = $('#form_nuevoNivel').val();
                        

                        if (nivel === '11') {                            //primaria
                            
                            $("#form_nuevoGrado").empty();
                            $("#form_nuevoGrado").append('<option value="">Seleccionar...</option>');
                            $("#form_nuevoGrado").append('<option value="1">Primero</option>');
                            $("#form_nuevoGrado").append('<option value="2">Segundo</option>');
                        }else{
                            $("#form_nuevoGrado").empty();
                            $("#form_nuevoGrado").append('<option value="">Seleccionar...</option>');
                            $("#form_nuevoGrado").append('<option value="1">Primero</option>');
                            $("#form_nuevoGrado").append('<option value="2">Segundo</option>');                            
                            $("#form_nuevoGrado").append('<option value="3">Tercero</option>');
                            $("#form_nuevoGrado").append('<option value="4">Cuarto</option>');
                            $("#form_nuevoGrado").append('<option value="5">Quinto</option>');
                            $("#form_nuevoGrado").append('<option value="6">Sexto</option>');
                        }                        
                        
                        
                    }

                    function cargarParalelos() {
                        var institucion = $('#form_idInstitucion').val();
                        var gestion = $('#form_idGestion').val();
                        var turno = $('#form_nuevoturno').val();
                        var nivel = $('#form_nuevonivel').val();
                        var grado = $('#form_nuevogrado').val();

                        $("#form_nuevoParalelo").empty();
                            $("#form_nuevoParalelo").append('<option value="">Seleccionar...</option>');
                            $("#form_nuevoParalelo").append('<option value="1">A</option>');
                            $("#form_nuevoParalelo").append('<option value="2">B</option>');                            
                            $("#form_nuevoParalelo").append('<option value="3">C</option>');
                            $("#form_nuevoParalelo").append('<option value="4">D</option>');
                            $("#form_nuevoParalelo").append('<option value="5">E</option>');
                            $("#form_nuevoParalelo").append('<option value="6">F</option>');

                        // if (xhr4 && xhr4.readyState != 4) {
                        //     xhr4.abort();
                        // }
                        // xhr4 = $.ajax({
                        //     type: 'get',
                        //     url: Routing.generate('creacion_cursos_solicitud_cargar_paralelos', {'idInstitucion': institucion, 'gestion': gestion, 'turno': turno, 'nivel': nivel, 'grado': grado}),
                        //     beforeSend: function () {
                        //         $("#form_nuevoparalelo").empty();
                        //         $("#form_nuevoparalelo").append('<option value="">Buscando...</option>');
                        //         $('#divAreas').empty();
                        //     },
                        //     success: function (data) {
                        //         $("#form_nuevoparalelo").empty();
                        //         $("#form_nuevoparalelo").append('<option value="">Seleccionar...</option>');
                        //         $.each(data.paralelos, function (i, value) {
                        //             $("#form_nuevoparalelo").append('<option value="' + i + '">' + value + '</option>');
                        //         });
                        //     }
                        // });
                    }

                    

                    var xhr1;
                    function validateForm() {
                        var turno = $('#form_nuevoturno').val();
                        var nivel = $('#form_nuevonivel').val();
                        var grado = $('#form_nuevogrado').val();
                        var paralelo = $('#form_nuevoparalelo').val();
                        if (turno == '') {
                            alert('Debe seleccionar un turno');
                            return false;
                        }
                        if (nivel == '') {
                            alert('Debe seleccionar un nivel');
                            return false;
                        }
                        if (grado == '') {
                            alert('Debe seleccionar un grado');
                            return false;
                        }
                        if (paralelo == '') {
                            alert('Debe seleccionar un paralelo');
                            return false;
                        }

                        if (xhr1 && xhr1.readyState != 4) {
                            xhr1.abort();
                        }

                        // var formData = $('#formAreas').serialize();
                        var formData = $('#formCursos').serialize();
                        $.ajax({
                            type: 'get',
                            url: Routing.generate('creacion_cursos_solicitud_listar_cursos'),
                            data: formData,
                            beforeSend: function () {
                                $("#divAreas").empty();
                                $("#divAreas").append("<div style='text-align:center'><img src='{{asset('img/loading.gif')}}'></div>");
                            },
                            success: function (data) {
                                $("#divAreas").empty();
                                $("#divAreas").append(data);
                                $('.chosen-select').chosen({allow_single_deselect: false});
                                $('.chosen-container').css('width', '100%');
                                //$(".tooltips").tooltip();
                            },
                            error: function (data) {
                                $("#divAreas").empty();
                                $("#divAreas").append('<div class="alert alert-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> No existe cursos y paralelos creados</div>');
                            }
                        });
                        return false;
                    }

                    var xhr2;                   
                    function validateFormNuevoCurso() {
                      
                        var turno = $('#form_nuevoTurno').val();
                        var nivel = $('#form_nuevoNivel').val();
                        var grado = $('#form_nuevoGrado').val();
                        var paralelo = $('#form_nuevoParalelo').val();
                        // var ancho = $('#form_nuevoAncho').val();
                        // var largo = $('#form_nuevoLargo').val();
                        if (turno == '') {
                            alert('Debe seleccionar un turno');
                            return false;
                        }
                        if (nivel == '') {
                            alert('Debe seleccionar un nivel');
                            return false;
                        }
                        if (grado == '') {
                            alert('Debe seleccionar un grado');
                            return false;
                        }
                        if (paralelo == '') {
                            alert('Debe seleccionar un paralelo');
                            return false;
                        }
                        // if (ancho == '') {
                        //     alert('Debe registrar ancho del curso');
                        //     return false;
                        // }
                        // if (largo == '') {
                        //     alert('Debe registrar largo del curso');
                        //     return false;
                        // }

                        if (xhr2 && xhr2.readyState != 4) {
                            xhr2.abort();
                        }

                        var formData = $('#formCursos').serialize();
                         if(confirm('¿Esta seguro de que desea crear el curso?\nPresione aceptar para confirmar.')){
                            $.ajax({
                                type: 'post',
                                url: Routing.generate('creacion_cursos_solicitud_listar_areas_nuevo_curso'),
                                data: formData,
                                beforeSend: function () {
                                    $("#divNuevoCurso").empty();
                                    $("#divNuevoCurso").append("<div style='text-align:center'><img src='{{asset('img/loading.gif')}}'></div>");
                                },
                                success: function (data) {
                                    if(data.exito == 1){
                                        $("#divNuevoCurso").empty();
                                        $("#divNuevoCurso").append('<div class="alert alert-success"><i class="glyphicon glyphicon-exclamation-sign"></i> Se realizo la solicitud con exito.</div>');
                                        cargarSolicitudesForm();
                                    }else{
                                        $("#divNuevoCurso").empty();
                                        if(data.mensaje === ''){
                                            $("#divNuevoCurso").append('<div class="alert alert-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> El curso no ha podido ser creado.</div>');    
                                        }else{
                                        $("#divNuevoCurso").append('<div class="alert alert-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> ' + data.mensaje + '</div>');    
                                        }
                                    }
                                    //$(".tooltips").tooltip();
                                },
                                error: function (data) {
                                    $("#divNuevoCurso").empty();
                                    $("#divNuevoCurso").append('<div class="alert alert-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> El curso no ha podido ser creado</div>');
                                }
                            });
                        }        

                        return false;        
                        
                    }

                    var xhr6; 
                    function cargarSolicitudesForm() {
                        
                        if (xhr6 && xhr6.readyState != 4) {
                            xhr6.abort();
                        }

                        // var formData = $('#formAreas').serialize();
                        var formData = $('#formCursos').serialize();
                        $.ajax({
                            type: 'get',
                            url: Routing.generate('creacion_cursos_solicitud_listar_solicitudes'),
                            data: formData,
                            beforeSend: function () {
                                $("#divNewCurso").empty();
                                $("#divNewCurso").append("<div style='text-align:center'><img src='{{asset('img/loading.gif')}}'></div>");
                            },
                            success: function (data) {
                                $("#divNewCurso").empty();
                                $("#divNewCurso").append(data);
                                $('.chosen-select').chosen({allow_single_deselect: false});
                                $('.chosen-container').css('width', '100%');
                                //$(".tooltips").tooltip();
                            },
                            error: function (data) {
                                $("#divNewCurso").empty();
                                $("#divNewCurso").append('<div class="alert alert-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> No existe solicitudes de creación cursos/paralelos</div>');
                            }
                        });
                        return false;
                    }

                    var xhr7;
                    function eliminarSolicitudes(solnum) {
                        
                        if (xhr6 && xhr6.readyState != 4) {
                            xhr6.abort();
                        }

                        // var formData = $('#formAreas').serialize();
                        // var formData = $('#formCursos').serialize();
                        $.ajax({
                            type: 'get',
                            url: Routing.generate('creacion_cursos_solicitud_eliminar_solicitud',{'solicitudnum': solnum}),
                            // data: formData,
                            beforeSend: function () {
                                $("#divNewCurso").empty();
                                $("#divNewCurso").append("<div style='text-align:center'><img src='{{asset('img/loading.gif')}}'></div>");
                            },
                            success: function (data) {
                                $("#divNewCurso").empty();
                                $("#divNewCurso").append(data);
                                $('.chosen-select').chosen({allow_single_deselect: false});
                                $('.chosen-container').css('width', '100%');
                                if(data.exito == 1){
                                    $("#divNewCurso").append('<div class="alert alert-success"><i class="glyphicon glyphicon-exclamation-sign"></i> Se elimino correctamente </div>');
                                } else {
                                    $("#divNewCurso").append('<div class="alert alert-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> No se elimino la solicitud</div>');
                                }
                                cargarSolicitudesForm();
                            },
                            error: function (data) {
                                $("#divNewCurso").empty();
                                $("#divNewCurso").append('<div class="alert alert-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> No se puede eliminar la solicitud realizada</div>');
                            }
                        });
                        return false;
                    }

                    /*
                    dcastillo, se ha aumentado parametros, para la creacion de la oferta
                    */
                    function mostrarAreas(nivel, grado, paralelo, idInstitucionCurso, idNivel, divResultado,institucioneducativa,gestionTipo,turnoTipo,nivelTipo,gradoTipo,paraleloTipo) {                        
                        

                        if(confirm('¿Esta seguro de que desea crear Areas?\nPresione aceptar para confirmar.')){                  
                            $.ajax({
                                type: 'get',
                                url: Routing.generate('areas_listar_areas_nivel', {'idNivel': idNivel, 'idCurso': idInstitucionCurso, 'institucioneducativa':institucioneducativa,'gestionTipo':gestionTipo, 'turnoTipo': turnoTipo,'nivelTipo':nivelTipo,'gradoTipo':gradoTipo,'paraleloTipo':paraleloTipo}),
                                beforeSend: function () {
                                    $("body").css("cursor", "progress");

                                    /*$("#areasModal").empty();
                                    $("#areasModal").append("<div style='text-align:center'><img src='{{asset('img/loading.gif')}}'></div>");*/
                                },
                                success: function (data) {
                                    /*$("#areasModal").empty();
                                    $("#areasModal").append(data);*/
                                    $("body").css("cursor", "default");
                                    if(data.exito == 1){
                                         alert('Las Areas han sido asignadas con exito !!');
                                    }else{
                                        if(data.exito == -1){
                                            alert(data.mensaje);

                                        }else{
                                             alert('No se han podido registrar Areas para este curso !! \nPosiblemente ya existen, por favor revisar.');    
                                        }

                                        
                                    }
                                   
                                }
                            });
                            //$('#newModal').modal('show');
                        }
                    }

                    function marcarTodasAreas() {
                        var marcar = document.getElementById('marcarTodos');
                        var areas = document.getElementsByName('areas[]');
                        if (marcar.checked) {
                            for (var i = 0; i < areas.length; i++) {
                                areas[i].checked = true;
                            }
                        } else {
                            for (var i = 0; i < areas.length; i++) {
                                if (areas[i].disabled != true) {
                                    areas[i].checked = false;
                                }
                            }
                        }
                    }

                    function enviarAreas() {
                        var educacionTipo = $('#educacionTipo').val();
                        var nivel = $('#idNivel').val();
                        if (educacionTipo != 'REGULAR') {
                            var marcados = 'si';
                            var areas = document.getElementsByName('areas[]');
                            for (var i = 0; i < areas.length; i++) {
                                if (!areas[i].checked) {
                                    marcados = 'no';
                                }
                            }
                            /*if (marcados == 'no') {
                                alert('Debe seleccionar todas las areas.');
                                return 0;
                            }*/
                        }


                        var div = $('#divResultado').val();
                        var formData = $('#formAreasModal').serialize();
                        $.ajax({
                            type: 'get',
                            url: Routing.generate('areas_listar_areas_curso_adicionar_eliminar'),
                            data: formData,
                            beforeSend: function () {
                                $("#divAreas").append("<div style='text-align:center' id='img-loading'><img src='{{asset('img/loading.gif')}}'></div>");
                                Messenger.options = {
                                    extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                                    theme: 'flat'
                                }

                                Messenger().post({
                                    message: 'Adicionando área, espere un momento...',
                                    type: 'info',
                                    showCloseButton: false
                                });
                            },
                            success: function (data) {
                                $("#divAreas").empty();
                                $("#divAreas").append(data);
                                $('.chosen-select').chosen({allow_single_deselect: false});
                                $('.chosen-container').css('width', '100%');
                                $('.tooltip')
                                Messenger().hideAll();
                                Messenger().post({
                                    message: 'Area adicionada correctamente',
                                    type: 'success',
                                    showCloseButton: false
                                });
                            },
                            error: function(data){
                                $("#img-loading").css('display','none');
                                $("#divAreas").append("<div class='alert alert-danger'>Ocurrio un error al registrar las áreas, intentelo de nuevo o comuniquese con un responsable del sistema</div>")
                                Messenger().hideAll();
                            }
                        });
                        $('#newModal').modal('hide');
                    }

                    var xhr6;
                    var deleteArea = function(idco, asignatura){

                                               
                        if(confirm('Esta seguro(a) de eliminar el área de '+ asignatura +'?\nTenga en cuenta que tambien se eliminaran las calificaciones de los estudiantes.')){
                            $.ajax({
                                type: 'get',
                                url: Routing.generate('areas_delete', {'idCursoOferta': idco}),
                                beforeSend: function () {
                                    Messenger.options = {
                                        extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-right',
                                        theme: 'flat'
                                    }

                                    Messenger().post({
                                        message: 'Eliminando, espere un momento...',
                                        type: 'info',
                                        showCloseButton: false
                                    });
                                },
                                success: function (data) {
                                    $("#divAreas").empty();
                                    $("#divAreas").append(data);
                                    $('.chosen-select').chosen({allow_single_deselect: false});
                                    $('.chosen-container').css('width', '100%');
                                    Messenger().hideAll();
                                },
                                statusCode: {
                                    500: function () {
                                        $("#divAreas").append('<div class="alert alert-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> No se puede eliminar el curso</div>');
                                        //setTimeout("$('#mensajeModal').empty()",5000);
                                        Messenger().hideAll();
                                    },
                                    404: function () {

                                    }
                                }
                            });
                        }
                    }
    var xhr5;
    var addpop = function(idco){
        if ($('#'+idco).is(':hidden')){
            if (xhr5 && xhr5.readyState != 4) {
                xhr5.abort();
            }
            xhr5 = $.ajax({
                type: 'post',
                data: ({idco: idco}),
                url: "{{ path('areas_maestros') }}",
                beforeSend: function () {
                    $('.divMaestros').hide();
                    $('.arrow-before').hide();
                    $('.arrow-after').hide();
                    $("#"+idco).empty();
                    $('#before'+idco).fadeIn();
                    $('#after'+idco).fadeIn();
                    $('#'+idco).fadeIn();
                    $('#'+idco).append("<div style='background:#FFFFFF; text-align:center; color:#286AFB'><div style='padding:10px 0px 10px 0px;'>Cargando maestros<br><img src='{{asset('img/loading-sm.gif')}}' style='margin-top:10px'></div></div>");
                },
                success: function (data) {
                    $("#"+idco).empty();
                    $("#"+idco).append(data);
                    $('.chosen-select').chosen({allow_single_deselect: false});
                    $('#'+idco).fadeIn();
                },
                statusCode: {
                    500: function () {

                    },
                    404: function () {

                    }
                }
            });
        }else{
            if (xhr5 && xhr5.readyState != 4) {
                xhr5.abort();
            }
            $("#"+idco).empty();
            $('#'+idco).fadeOut();
            $('#before'+idco).fadeOut();
            $('#after'+idco).fadeOut();
        }
    }

    var cerrarMaestros = function(idco){
        $("#"+idco).empty();
        $('#'+idco).fadeOut();
        $('#before'+idco).fadeOut();
        $('#after'+idco).fadeOut();
    }

    var xhr6;
    var asignarMaestro = function(){
        if (xhr6 && xhr6.readyState != 4) {
            xhr6.abort();
        }

        var enviar = true;
        var mensaje = "";

        $(".maestro").each(function (index) {
            if($(this).val() == ""){
                enviar = false;
                console.log('select:',$(this).val());
                mensaje = "Seleccione un maestro y asigne las horas de trabajo.";
            }
        });

        $(".horas").each(function (index) {
            if($(this).val() == 0 || $(this).val() == ""){
                enviar = false;
                console.log('Hora:',$(this).val());
                if(mensaje == ""){
                    mensaje = "Debe completar las horas de trabajo (No puede ser 0 horas).";
                }
            }
        });

        if(enviar == false){
            alert(mensaje);
            return false;
        }else{
            var formData = $('#formMaestros').serialize();
            xhr6 = $.ajax({
                type: 'post',
                data: formData,
                url: "{{ path('areas_maestros_asignar_siged') }}",
                beforeSend: function () {

                },
                success: function (data) {
                    //$('#28030476'),append(data);
                    var idco = data.ieco;

                    $('#'+idco).empty();
                    $('#'+idco).append("<div style='background:#906094; color:#FFFFFF; padding:5px; text-align:center;'>"+ data.mensaje +"</div>");
                    setTimeout("cerrarMaestros('"+idco+"')",1000);

                },
                statusCode: {
                    500: function () {

                    },
                    404: function () {

                    }
                }
            });
            return true;
        }
    }

    </script>
{% endblock %}
